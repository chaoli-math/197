就像拓扑或者微分流形是由Euclid空间的开球粘起来的一样，概形是由一类被称为\textit{仿射概形}的开集粘合起来的。但这有一个主要的不同，在流形上，一点局部来看和另一点是相似的，开球也是整个构造需要的唯一开集，它们相同且非常简单，而概形的局部则更多样。即使是概形中最小的开集也大到许多有趣和不平凡的几何将在这些开集中发生。实际上，在许多概形中，没有两个点有同构的开邻域（除了整个概形）。因此，我们将花费一大部分时间来描述仿射概形。

在这章中，我们将列出一些基本的定义，同时将通过一系列简单的习题来体现与运用这些定义。这章给出的例子大部分是最简单的那种，进而也不一定是那种具有有趣几何的例子。更有代表性的一类例子将在下一章给出，在那里我们意欲指出概形与簇概念的不同，同时表现出概形观点所具有的一统的力量。

\section{仿射概形}

\textit{仿射概形}\index{概形!仿射}是从交换环构造出的对象。仿射概形与环的联系是仿射簇与其坐标环之间联系的模仿与推广。实际上，我们能以下面的方式得到概形的定义。经典代数几何的基本对应是双射
\[
	\{\text{仿射簇}\}\quad \leftrightarrow\quad \{\text{代数闭域$K$上的有限生成无非平凡零因子环}\}
\]

上面对应的左侧是我们感兴趣的朴素几何对象：多项式族的零点集。如果我们说这些是感兴趣的对象，我们将得到右侧受限制的环范畴。但若改用相反的观点，即我们不再满足于限制“有限生成”、“无非平凡零因子”或者“$K$\hyp 代数”，希望右侧包含所有的交换环，此时怎样的几何对象将出现在左侧呢？于是，概形理论出现了，问题的答案是“仿射概形”，在这节中，我们将展示如何拓展上面对应到下图：
\[
\begin{xy}
	\xymatrix{
		\{\text{仿射簇}\}\ar[d]&\ar@{<->}[r]&&\left\{\text{代数闭域$K$上的有限生成无非平凡零因子环}\right\}\ar[d]\\
		\{\text{仿射概形}\}&\ar@{<->}[r]&&\{\text{含幺交换环}\}
	}
\end{xy}
\]

我们将看到，实际上环与对应的仿射概形是等价对象。然而，概形对于许多几何命题是更自然的背景，概形的语言将允许我们在后续章节中一般化我们的构造。

预做准备，微分流形为我们定义概形提供了一个范例。微分流形$M$最初被定义为将开球粘合而得的东西，即具有坐标卡的图册的拓扑空间。然而，指定$M$上的流形结构等价于指定$M$上哪些连续函数在任意开集上是可微的。可微性是局部概念，因此，连续函数层$\mathscr{C}(M)$中的可微函数构成了子层$\mathscr{C}^\infty (M)$（层的定义将在下面给出）。这样，我们可以给出微分流形的另一个定义：这是一个拓扑空间$M$，附上一个$\mathscr{C}(M)$的子层$\mathscr{C}^\infty(M)$，使得$(M,\mathscr{C}^\infty(M))$局部同构于$\rr^n$与其上的可微函数层。同样，能用函数层来定义许多其他的几何结构，比如，实解析流形、复解析流形和Nash流形都可以这样定义。我们将采用类比的手段来定义概形：一个概形是一个拓扑空间$X$附上一个层，局部同构于下面定义的仿射概形。

令$R$是一个交换环。$R$所定义的仿射概形将被记作$\spec R$，称为环$R$的\idx{谱}。如前所示，仿射概形（就像任意概形）包含了一个点集，点集上的一个被称为\textit{Zariski拓扑}的拓扑，以及这个拓扑空间上的一个层$\oo_{\spec R}$，称为\textit{正则函数层}或者这个概形的\textit{结构层}。当可能产生疑义的时候，我们将用记号$|\spec R|$来表示仿射概形的那个集合或者拓扑空间，没有层结构；如果从上下文中我们想表达的你都懂的（比如，“$\spec R$中的一个开子集”），此时我们将略去两边的竖线。

我们用三步来定义仿射概形$\spec R$，首先是它的集合，然后是它的拓扑结构，最后是层结构。

\subsection{作为集合的概形}\label{s.1.1.1}

我们定义$\spec R$中的一个点是$R$的一个素理想。为了避免符号混用，通常以$[\pp]$来记$\spec R$中对应于素理想$\pp$的点。按照一般习惯，我们将认为$R$本身不是一个素理想。当然，如果$R$是一个整环，则$(0)$理想是素理想。

如果$R$是一个寻常的代数闭域上的仿射概形$V$的坐标环，$\spec R$中的对应于$R$的极大理想的点将对应于仿射概形中的点，同时对$V$的每个不可约子簇，$\spec R$中还将对应有一点。这些新添的点，对应于正维数的子概形，虽然一开始会让人心神不安但后来就变得方便起来，它们将担当经典代数几何中“一般点”的角色。

\begin{exe}
确定$\spec R$，当$R$是~~~~(a) $\zz$;~~~~(b) $\zz/(3)$;~~~~(c) $\zz/(6)$;~~~~(d) $\zz_{(3)}$;~~~~(e) $\cc[x]$;~~~~(f) $\cc[x]/(x^2)$.
\end{exe}

每一个$R$中的元素$f$都将在$X=\spec R$上定义一个“函数”，我们依然记作$f$：对$x=[\pp]\in \spec R$，记$\kappa(x)$或者$\kappa(\pp)$为整环$R/\pp$的商域，称为$X$在点$x$处的\idx{剩余类域}，同时典范映射
\[
	R\to R/\pp\to \kappa(x)
\]
下$f$在$\kappa(x)$中的像定义为$f(x)$.

\begin{exe}
	“函数”$15$在点$(7)\in \spec \zz$的值是什么？在点$(5)$处呢？
\end{exe}

\begin{exe}
	\begin{compactenum}[{(a)}]
		\item 考虑多项式环$\cc[x]$，令$p(x)$是一个多项式。证明，若$\alpha\in\cc$是一个数，则$(x-\alpha)$是一个$\cc[x]$的素理想，并且，存在$\kappa((x-a))$与$\cc$的自然等同，使得点$(x-\alpha)\in\spec\cc[x]$处的值$p(x)$就是数$p(\alpha)$.
		\item 更一般地，如果$R$是一个代数闭域上的仿射簇$V$的坐标环，$\pp$是一般意义上对应于点$x\in V$的极大理想，则$\kappa(x)=K$以及$f(x)$就是一般意义上函数$f$在点$x$处的值。
	\end{compactenum}
\end{exe}

一般地，“函数”$f$取值的域逐点不同。此外，$f$也没必要由在其“函数”每一点的值决定。比如，如果$K$是一个域，环$R=K[x]/(x^2)$只有一个素理想$(x)$，于是对应元素$x\in R$，虽然是非零的，但诱导了一个“函数”在$\spec R$上处处为零。

我们直接将$\spec R$上的正则函数\index{正则!函数}定义为$R$的一个元素。于是一个正则函数给出了$\spec R$上的一个“函数”，但他并不由这个“函数”的值决定。

\subsection{作为拓扑空间的概形}

通过正则函数，我们可以将$\spec$修饰成一个拓扑空间，这个拓扑被称为\textit{Zariski拓扑}\index{Zariski!拓扑}. 闭集定义如下，对$R$的任意子集$S$，令
\[
	V(S)=\{x\in \spec R\,|\, \text{$f(x)=0$对每一个$f\in S$都成立}\}=\{[\pp]\in\spec R\,|\, \pp\supset S\}.
\]

这个定义的动机是让每个$f\in R$都表现得尽可能像一个连续函数。当然，域$\kappa(x)$没有拓扑，因为它逐点变化让一般意义上的连续无从谈起。但至少，它们都包含了一个零元，于是我们就可以谈$f\in R$在$\spec R$上的零点集，如果$f$像一个连续函数，则零点集应该是一个闭集。因为闭集族相交必须是闭集，我们立即得到了上述定义：$V(S)$就是$S$中所有元素的零点集的交。

为使得所有$V(S)$是闭集，它们的任意交也必须在该族里面。从上面的描述很清楚，对一族集合$S_a$，我们有$\bigcap_a V(S_a)=V(\bigcup_a S_a)$，这正是需要的。此外，如果$I$是$S$生成的理想，则$V(I)=V(S)$.

Zariski拓扑中的一个开集即一个$V(S)$的补。只有一个元素的集合$S$对应的开集有着特殊的地位，本质上是因为它们依旧是某个环的谱。由这个原因，我们有一个特殊的名字与记号。设$f\in R$，定义关联于$f$的{\it distinguished}\footnote{译者注：这里的英文是`distinguished'，日文wiki翻译为“識別可能”，但如果翻译成“可识别的”似乎不太合适，所以后面正文中出现的`distinguished open set'都当作`basic open set'翻译。}（或者\textit{基本}）开集为
\[
	X_f=|\spec R|\setminus V(f).
\]

$X_f$的点是$R$中不包含$f$的素理想，其一一对应于$R$添上$f$的逆的局部化$R_f$的素理想，对应关系为$\pp\subset R$到$\pp R_f\subset R_f$. 因此，我们能等同$X_f$与$\spec \rr_f$中的点，我们将在本书的剩余部分默认这个等同。

基本开集构成了Zariski拓扑的一组\textit{拓扑基}，实际上，任意的开集都是一族基本开集的并：
\[
	U=\spec R\setminus V(S)=\spec R\setminus\bigcap_{f\in S}V(f)=\bigcup_{f\in S}(\spec R)_f.
\]

基本开集的有限交也还是基本开集，因为一个素理想包含一个乘积当且经当它包含其中一个因子，对$g=f_1\cdots f_n$，我们有
\[
	\bigcap_{i=1}^n (\spec R)_{f_i}= (\spec R)_{g}.
\]
特别地，基本开集如果是某个基本开集$(\spec R)_f$的子集，则它具有形式$(\spec R)_{fg}$.

$\spec R$几乎不会是一个Hausdorff空间，它的开集太大了。实际上，$\spec R$中只有对应于极大理想的点才是闭的。一般地，很清楚，包含给定点$[\pp]$的最小闭集必须是$V(\pp)$，于是$[\pp]$的闭包包含所有的$[\mathfrak{q}]$使得$\mathfrak{q}\supset\pp$. 因此，点$[\pp]$是闭集当且仅当$\pp$是极大的。于是当$R$是代数闭域上的代数簇$V$的坐标环时，$V$的点一一对应着$\spec R$的闭点，以及对应于点$[\pp]$的闭包中的点就是$V$中由$\pp$确定的子簇的点。

\begin{exe}
	\begin{compactenum}[{(a)}]
		\item $\spec \cc[x]$中的点是素理想$(x-a)$与$(0)$，其中$a\in\cc$. 描述它的拓扑。哪些点是闭的？闭点中是否有一个开的？
		\item 令$K$是一个域，而$R$是局部环$K[x]_{(x)}$. 描述拓扑空间$\spec R$. （这个的答案将在本节后面给出。）
	\end{compactenum}
\end{exe}

为了完成$\spec R$的定义，我们必须描述\textit{结构层}或者说$X$上的\textit{正则函数层}。在做这个之前，我们将暂时离开主线给出一些层理论的基本定义以及证明一个以后必须的命题（Proposition \ref{pro:1.1.12}）。

\subsection{插曲：层理论}

令$X$是任意拓扑空间。$X$上的一个\textit{预层}\index{预层}$\mathscr{F}$是对每一个$X$中的开集$U$都附上一个集合，记作$\mathscr{F}(U)$, 以及对每一列开集$U\subset V\subset X$，有一个\textit{限制映射}
\[
	\res_{V,U}:\ff(V)\to \ff(U)
\]
满足
\[
	\res_{U,U}=\mathrm{identity}
\]
以及对所有$U\subset V\subset W\subset X$
\[
	\res_{V,U}\circ \res_{W,V}=\res_{W,U}.
\]
$\ff(U)$中的元素被称为\textit{$\ff$在$U$上的截面}，$\ff(X)$中的元素被称为\textit{整体截面}\index{截面!整体}。

表述这个定义的另一种方式是将\textit{预层}定义为一个$X$上的开集范畴（对每一个包含$U\subset V$有一个态射$U\to V$）到集合范畴的反变函子。改变目标范畴到交换群范畴，我们就得到了交换群预层，类似地，可以将目标范畴改成环、代数等。

这类构造中最重要的是在拓扑空间$X$上的一个环预层$\oo$上的\textit{模预层}$\ff$. 这样一个东西包含一对
\begin{quote}
对每一个$X$的开集$U$，都有一个环$\oo(U)$以及一个$\oo(U)$\hyp 模$\ff(U)$
\end{quote}
以及
\begin{quote}
任取包含$U\supset V$，有一个环同态$\alpha:\oo(U)\to\oo(V)$，通过$\alpha$将$\ff(V)$看成$\oo(U)$\hyp 模，还应有一个$\oo(U)$\hyp 模同态$\ff(U)\to\ff(V)$.
\end{quote}

一个（集合、交换群、环、模等）预层如果他还满足被称为\textit{层公理}\index{层!公理}的一些新条件时，它被称为一个\textit{层}。这个条件是，对每一个$U\subset X$的开覆盖$U=\bigcup_{a\in A}U_a$，以及任意一族
\[
	f_a\in \ff(U_a)\quad \text{对每一个}a\in A
\]
如果满足，任取$a$, $b\in A$，如果$f_a$与$f_b$限制到$U_a\cap U_b$相同，则存在唯一的元素$f\in \ff(U)$使得其限制在$U_a$上就是$f_a$对每一个$a$都成立。

这里有个平凡但时常引起混乱的点值得一提。空集$\varnothing$当然是$\spec R$的一个开集，他也能被写作一个空族的并（即，上一段中的指标集$A$是一个空集）。因此，层公理告诉我们，任意的层都有且只有一个开集上的截面。特别地，对一个环层$\ff$，$\ff(\varnothing)$是零环（即$0=1$的环）。注意到零环没有素理想，如果承认选择公理，这也是唯一不含素理想的一个含幺环，于是它的谱是$\varnothing$.

\begin{exe}
	\begin{compactenum}[{(a)}]
		\item 令$X$是一个二元素集$\{0,1\}$，通过将他的四个子集都取成开集赋予$X$的一个拓扑结构。因此$X$上的一个层是四个集合与它们之间的映射，描述这些对象之间的关系。（$X$实际上具有形式$\spec R$，你能找到一个$R$吗？）
		\item 同样$X$是二元素集$\{0,1\}$，此时$X$上的拓扑使得只有$\varnothing$, $\{0\}$与$\{0,1\}$为开集，同上描述这个拓扑空间上面的层。同样，这个空间可以实现为某个$\spec R$.
	\end{compactenum}
\end{exe}

若$\ff$是一个$X$上的预层，而$U$是$X$的开子集，我们能定义一个$U$上的预层$\ff|_U$通过令$\ff|_U(V)=\ff(V)$，其中$V$是$U$的开子集，限制映射与那些在$\ff$上的相同，这个预层被称为$\ff$在$U$上的\textit{限制}。容易看到，如果$\ff$是一个层，则$\ff|_U$也是一个层。

由于下面我们将只在只有具有交换群结构的层上工作，所以我们将常常略去“交换群”这些字。给两个交换群预层，我们能逐开集定义它们的直和、张量积等等概念，比如，如果$\ff$与$\scrg$是两个交换群预层，我们通过对每一个开集$U$定义
\[
	(\ff\oplus\scrg)(U):=\ff(U)\oplus \scrg(U)
\]
来定义出$\ff\oplus\scrg$. 这样的操作总是可以产生一个预层，如果$\ff$和$\scrg$是层，则$\ff\oplus\scrg$也是一个层。但是对张量积就不是这样了：即使$\ff$和$\scrg$是层，
\[
	(\ff\otimes\scrg)(U):=\ff(U)\otimes \scrg(U)
\]
定义的预层也不一定是一个层，我们将把层$\ff\otimes\scrg$定义成这个预层的层化，层化后面会描述。

任意拓扑空间$X$上最简单的层是取值于集合$K$中的局部常值函数的层，即层$\mathscr{K}$满足$\mathscr{K}(U)$是从$U$到$K$的局部常值函数的集合。如果$K$是一个群，我们可以通过逐点定义加法将$\mathscr{K}$做成一个群层。同样的，如果$K$是一个环，则我们可以在$\mathscr{K}(U)$逐点定义乘法，这样$\mathscr{K}$就变成了一个环层。当$K$有一个拓扑结构，我们能定义$K$\hyp 值\textit{连续函数层}为层$\mathscr{C}$，其中$\mathscr{C}(U)$是所有从$U$到$K$的连续函数的集合，当然依然逐点定义加法。如果$X$是一个微分流形，同样存在可微函数层、矢量场层、微分形式层等等。

一般地，如果$\pi:X\to Y$是任意拓扑空间之间的映射，我们定义$\pi$的界面层$\mathscr{J}$通过，对每一个$X$开集$U$，我们定义$\mathscr{J}(U)$是所有使得$\pi\circ \sigma=1$的连续函数$\sigma:U\to \pi^{-1}U$的集合，其中$1$是$U$上的恒同映射（这样一个映射被称为集合论意义上的$\pi$的截面：对任意层$\ff$，$\ff(U)$中元素被称为截面正是从这个例子中推广而来的）。

\begin{exe}
（对那些熟悉矢量丛的读者。）令$V$是一个拓扑空间$X$上的矢量丛。沿着$V$的截面层是$X$上的连续函数层上的一个模层。（模层一般而言在这个方式上可以看成矢量丛的推广。）
\end{exe}

另一个描述层的方式是它的茎（stalk）。给定任意预层$\ff$以及一个点$x\in X$，我们定义$\ff$在点$x$处的\textit{茎}\index{茎}$\ff_x$为在所有包含$x$的开集$U$上$\ff(U)$的\textit{直极限}\index{极限!直}，
\[
	\ff_x={\varinjlim}_{x\in U}\ff(U)=\left\{
		\parbox{20em}{
			$\ff(U)$关于所有包含$x$的开集$U$的不交并，模去如下等价关系：$\sigma\sim \tau$如果对$\sigma\in\ff(U)$以及$\tau\in\ff(V)$，存在一个包含$x$的开集$W\subset U\cap V$使得$\sigma$和$\tau$限制在$W$上相同，即\[\res_{U,W}\sigma=\res_{V,W}\tau.\]
		}
	\right\}
\]

对每个$x\in U$，存在一个映射$\ff(U)\to \ff_x$, 将截面$s$变成等价类$(U,s)$，这个等价类被记作$s_x$. 如果$\ff$是一个层，$\ff$在$U$上的截面$s\in\ff(U)$由它对每一个$x\in U$的像$\ff_x$决定 ------ 等价地，$s=0$当且仅当对每一个$x\in U$都有$s_x=0$. 这来自于层公理：说$s_x=0$对每一个$x\in U$都成立，等价于对每一个$x$都存在一个$x$的邻域$U_x\subset U$使得$\res_{U,U_x}(s)=0$，于是在$\ff(U)$中$s=0$.

茎的概念有个熟悉的几何含义：这是芽环概形的抽象化。比如，若$X$是一个$n$维解析流形，而$\oo_X^{\text{an}}$是$X$上的解析函数层，则$\oo_X^{\text{an}}$在$x$处的茎就是$x$处的解析函数芽，即$n$元收敛幂级数环。

\begin{exe}
找到Exercise {{\addtocounter{thm}{-2}}\thethm{\addtocounter{thm}{1}}}与{\thethm{\addtocounter{thm}{1}}}中层的茎。
\end{exe}

\begin{exe}
	设$\overline{\ff}=\bigcup \ff_x$是$\ff_x$们的不交并，可以将$\overline{\ff}$拓扑化如下：取$\overline{\ff}$中的开集基为所有形如
	\[
	\mathscr{V}(U,s):=\{(x,s_x)\,:\,x\in U\}
	\]
	的集合，其中$U$是一个开集，而$s$是一个$U$上的截面。
	\begin{compactenum}[(a)]
	\item 证明，自然映射$\pi:\overline{\ff}\to X$是连续映射，以及，对$U$以及$s\in \ff(U)$，从$U$到$\overline{\ff}$的映射$\sigma:x\mapsto s_x$是一个$\pi$在$U$上的连续截面（即，他是连续的，且$\pi\circ\sigma$是$U$上的恒等函数）。
	\item 反之，证明任意使得$\pi\circ\sigma$是$U$上的恒等函数的连续函数$\sigma:U\to \overline{\ff}$都可以这样得到。\\
	\textit{提示}. 取$x\in U$以及包含$\sigma(x)$的基本开集$\mathscr{V}(V,t)$，其中$V\subset U$. 那么，$t$要变成$\sigma$需要满足哪些条件？
	\end{compactenum}
\end{exe}

这个构造说明了，截面$\pi:\overline{\ff}\to X$的芽构成的层同构于$\ff$，于是任意的层“是”一个合适映射的截面的芽层。在早期的工作中，层就是这样定义的。拓扑空间$\overline{\ff}$被称为层的``espace \'{e}tal\'{e}''，因为它的开集都是“平坦展开”于$X$的开集上。

空间$X$上的一个层的\idxx{层的}{态射}$\varphi:\ff\to\scrg$是一族映射$\varphi(U):\ff(U)\to \scrg(U)$，使得对每一个包含$U\subset V$，图
\[
	\xymatrix{
	\ff(V)\ar[r]^{\varphi(V)}\ar[d]_{\res_{V,U}}&\scrg(V)\ar[d]^{\res_{V,U}}\\
	\ff(U)\ar[r]_{\varphi(U)}&\scrg(U)
	}
\]
是交换的。（在范畴论的语言中，一个层之间的态射是对应的从拓扑空间的开集范畴到集合范畴函子之间的自然变换。）

对每一个$x\in X$，态射$\varphi:\ff\to\scrg$同样诱导了茎之间的态射$\varphi_x:\ff_x\to\scrg_x$. 从层公理，态射也被它在茎上诱导的态射决定：如果$\varphi$和$\psi$是对$x\in X$处处满足$\varphi_x=\psi_x$的态射，则$\varphi=\psi$.

我们说层之间的态射$\varphi:\ff\to\scrg$是单、满或者双射，如果每一个茎上诱导的态射$\varphi_x:\ff_x\to\scrg_x$是单、满或者双射。下面的习题说明了，这些概念如何将这个定义与通过任意集合上的截面来定义这种更加朴素的方式相联系。

\begin{exe}
	证明，如果$\varphi:\ff\to\scrg$是层之间的态射，于是，$\varphi(U)$是单射（双射）对所有开集$U$都成立，当且仅当$\varphi_x$对每一个$x\in X$都是单射（双射）。
\end{exe}

\begin{exe}
	通过检查下面的例子，Exercise {{\addtocounter{thm}{-1}}\thethm{\addtocounter{thm}{1}}}中将条件“单射”改做“满射”是错误的。在这些例子中，$\varphi$在茎上诱导的映射是满的，但是却存在开集$U$使得$\varphi(U):\ff(U)\to \scrg(U)$不是满射。
	\begin{compactenum}[(a)]
	\item 令$X$是拓扑空间$\mathbb{C}\setminus \{0\}$，令$\ff=\scrg$是处处非零的连续复值函数层，令$\varphi$是将函数$f$映射到$f^2$的映射。

	\item 令$X$是Riemann球面$\mathbb{CP}^1=\mathbb{C}\cup\{\infty\}$以及$\scrg$是其上的解析函数层。令$\ff_1$是在点$0$处为零的解析函数构成的层：当$U$包含$0$，$\ff_1(U)$是在点$0\in U$处为零的$U$上的解析函数的集合，如果$U$不含$0$，则$\ff_1(U)$是$U$上所有解析函数的集合。类似地，令$\ff_2$是在$\infty$为零的解析函数层，令$\ff=\ff_1\oplus\ff_2$，以及$\varphi:\ff\to\scrg$是加法映射。

	\item 找到一个例子，其中$X$只包含三个点。
	\end{compactenum}
\end{exe}

这些例子是层的上同调理论的起点，读者将在第\pageref{ref:1}页中列出的层理论的参考文献中找到更多这方面的材料。

若$\ff$是一个$X$上的预层，我们定义$\ff$的\idx{层化}为唯一的层$\ff'$与预层态射$\varphi:\ff\to\ff'$使得对每一个$x\in X$都有$\varphi_x:\ff_x\to\ff'_x$是一个同构。更准确地说，层$\ff'$能被如下定义：一个$\ff'$在开集$U$上的截面是一个映射$\sigma$，它将每一点$x\in U$映射成$\ff_x$中的一个元素，使得$\sigma$是由$\ff$的截面\textit{局部诱导}的，这就是说，存在$U$的一个开覆盖$U_i$，以及元素$s_i\in \ff(U_i)$使得对$x\in U_i$都有$\sigma(x)=(s_i)_x$. 映射$\ff\to\ff'$被定义为将$s\in\ff(U)$变成函数$x\mapsto s_x\in\ff_x$. 层$\ff'$可以被称为“最近似于”预层$\ff$的层。

\begin{exe}
	这里有$\ff'$的另一个构造：如同Exercise {{\addtocounter{thm}{-3}}\thethm{\addtocounter{thm}{3}}}中那样将不交并$\overline{\ff}=\bigcup \ff_x$拓扑化，接着令$\ff'$是$\overline{\ff}$在自然映射$\pi:\overline{\ff}\to X$下的截面层。说服你自己，这两个构造是等价的，以及这个构造满足上一段开头说的泛性质。
\end{exe}

若$\varphi:\ff\to\scrg$是一个层之间的单射，我们将称$\ff$是$\scrg$的\idx{子层}。我们常常略去符号$\varphi$，将它记作$\ff\subset \scrg$. 若$\varphi:\ff\to\scrg$是层之间的任意映射，预层$\ker\varphi$定义为$(\ker\varphi)(U)=\ker(\varphi(U))$是一个$\ff$的子层。

商的概念更加微妙。假设$\ff$和$\scrg$是交换群预层，其中$\ff$到$\scrg$有一个单射。那么$\scrg$关于$\ff$的商预层定义为由$\mathscr{H}(U)=\scrg(U)/\ff(U)$定义的预层$\mathscr{H}$. 但是当$\ff$和$\scrg$是层的时候，$\mathscr{H}$一般\textit{不一定}是一个层，我们必须将他们的商层定义为$\mathscr{H}$的层化，即$\scrg/\ff:=\mathscr{H}'$. 从$\mathscr{H}$到$\mathscr{H}'$的自然映射，连同上$\scrg\to \mathscr{H}$的预层间映射，定义了商映射$\scrg\to \scrg/\ff$. 这个映射是$\varphi$的\idx{余核}。

层公理的重要性在于，层是由其局部性质所决定。我们将给出这个原理的两个表现。

在概形的应用中，我们将遇到如下情况：已知拓扑空间$X$的一个\textit{拓扑基}$\mathscr{B}$，然后我们想要确定一个层$\ff$通过仅对基中的元素$U$说有群$\ff(U)$，以及对基中的包含$V\subset U$有同态$\res_{V,U}$. 下一个命题就说明了我们可以这样做。

若对每一个$U\in\mathscr{B}$有群$\ff(U)$，以及对基中的包含$V\subset U$有映射$\res_{V,U}:\ff(V)\to \ff(U)$，满足对基本开集\footnote{译者注：似乎书中对拓扑基里面的元素都叫基本开集（basic open set）.}到基本开集的限制与基本开集的基本开集覆盖的层公理，我们称$\ff$是一个$\mathscr{B}$\hyp 层。（在定义中，$U_a$, $U_b\in\mathscr{B}$上的截面集限制在$U_a\cap U_b$相等需要改做，它们限制在任意包含于$U_a\cap U_b$的基本开集$V$上都相同。）

\begin{pro} \label{pro:1.1.12}
	令$\mathscr{B}$是$X$的一个开集基。
	\begin{compactitem}
		\item[{\rm (i)}] 每个$\mathscr{B}$\hyp 层都可以唯一扩张为$X$上的一个层。
		\item[{\rm (ii)}] 给定$X$上的层$\mathscr{F}$与$\mathscr{G}$，以及对每一个$U\in \mathscr{B}$有映射
		\[
		\tilde{\varphi}(U):\mathscr{F}(U)\to \mathscr{G}(U),
		\]
		这族映射与限制映射可交换，则存在唯一的层态射$\varphi:\mathscr{F}\to \mathscr{G}$使得$\varphi(U)=\tilde{\varphi}(U)$对每一个$U\in \mathscr{B}$都成立。
	\end{compactitem}
\end{pro}

\begin{proof}[证明的开始]
	对每一个$X$的开集$U$，定义$\ff(U)$为集合$\ff(V)$们的逆极限\index{极限!逆}，其中$V$跑遍所有包含于$U$的基本开集：
	\[
	\begin{aligned}
	\ff(U)&={\varprojlim}_{V\subset U,V\in\mathscr{B}}\ff(V)\\
	&=\left\{\parbox{30em}{
			集合族$(f_V)_{V\subset U,V\in\mathscr{B}}\in \prod_{V\subset U,V\in\mathscr{B}}(V)$使得当$V$, $W\in\mathscr{B}$以及$W\subset V\subset U$时有$\res_{V,W}(f_V)=f_W$.
		}\right\}
	\end{aligned}
	\]
	限制映射直接由逆极限的泛性质所定义。
\end{proof}

\begin{exe}
	检验层公理以完成上述命题的证明，并证明，在$U\in \mathscr{B}$上，新定义的$\ff$与原本的层的截面集相同。
\end{exe}

第二个应用，其实是上一个应用的特例，就是说定义一个层只需在一个开覆盖的每个开集上给出一个层，如果这些层是相容的。

\begin{coro}
令$\mathscr{U}$是$X$的一个开覆盖。如果$\ff_U$是$U\in\mathscr{U}$上的一个层，如果
\[
	\varphi_{UV}:\ff_U|_{U\cap V}\to \ff_V|_{U\cap V}
\]
是在任意的在$U\cap V\cap W$上满足相容性条件
\[
	\varphi_{VW}\varphi_{UV}=\varphi_{UW}
\]
的一族同构，其中$U$, $V$, $W\in\mathscr{U}$. 则在$X$上存在唯一的层$\ff$，他限制在每个$U\in\mathscr{B}$上都同构于$\ff_U$，通过与$\varphi_{UV}$相容的同构$\Phi_U:\ff|_U\to \ff_U$，换句话说，对所有$U$, $V\in\mathscr{U}$使得
\[
	\varphi_{UV}\circ \Phi_U|_{U\cap V}=\Phi_V|_{U\cap V}:\ff|_{U\cap V}\to \ff_V|_{U\cap V}.
\]
\end{coro}

\begin{proof}
	所有包含于某个$U\in\mathscr{B}$的开集构成了$X$的一个拓扑基$\mathscr{B}$. 对每一个这样的开集$V$，选一个$U$包含它，然后定义$\ff(V)=\ff_U(V)$. 如果对某个$W\subset V$，值$\ff(W)$已经被另一个$\ff_{U'}$所定义，我们使用同构$\varphi_{UU'}$来定义限制映射。由同构$\varphi_{UU'}$的相容性条件，这些映射满足正确的复合关系。于是我们有一个$\mathscr{B}$\hyp 层，继而有了一个层。
\end{proof}

层的前推是很基本（也很平凡）的，我们在这里引入它：若$\alpha:X\to Y$是一个拓扑空间间的连续映射，而$\ff$是$X$上的一个预层，我们定义预层$\ff$对映射$\alpha$的前推$\alpha_*\ff$为$Y$上由
\[
	\alpha_*\ff(V):=\ff(\alpha^{-1}(V))
\]
给出的预层，其中$V$是$Y$的任意开集。当然，一个交换群层（环层，环层上的模层等等）依然是相同类型的层。

\begin{exe}
证明，层的前推还是一个层。
\end{exe}

\paragraph*{层理论的参考文献.}\label{ref:1} Serre的里程碑论文 [1955]依然是一个很好的材料，正是它确立了层是代数几何的重要工具。Godemant [1964]和Swan [1964]是更系统的介绍。Hartshorne [1977, Chapter II]包含了适应于概形理论的技术性需求的层理论的一个极好的陈述；这是一个Grothendieck [1961a; 1961b; 1963; 1964; 1965; 1966; 1967]中相关内容的简化版。解析情形不错的参考文献有Forster [1981]（特别是上同调理论引论）以及Gunning [1990].

\subsection{作为概形的概形（结构层）}

最后，我们回到概形$X=\spec R$的定义。我们将具体描述结构层$\oo_X=\oo_{\spec R}$来结束整个定义。就像之前说过的，我们希望$\spec R$和$R$之间的联系可以扩展仿射簇与其坐标环之间的联系，特别地，我们希望，结构层$\oo_X$的整体截面环就是$R$.

因此，我们希望将$X$上的函数环延拓到一整个环层。这就意味着，对每一个$X$的开集$U$，我们要给出一个环$\oo_X(U)$，以及对每一对开集$U\subset V$，要给出限制同态
\[
	\res_{V,U}:\oo_X(V)\to \oo_X(U)
\]
满足一系列前面说过的公理。对与基本开集$U$和$V$来说，环$\oo_X(U)$与映射$\res_{V,U}$并不难给出：我们令
\[
	\oo_X(X_f)=R_f.
\]
若$X_f\supset X_g$，则存在一个$g$的幂具有因子$f$（回忆，$(f)$的根是所有包含$f$的素理想的交），因此，限制映射$\res_{X_f,X_g}$可以取作局部化映射
\footnote{译者注：这里并不直观。考虑乘性子集$S$，以及它其中元素的任意因子构成的集合$S'$，后者自然也是一个乘性子集。注意到，此时$S^{-1}R$与${S'}^{-1}R$是同构的。首先，从$S^{-1}R$到${S'}^{-1}R$有一个自然的单同态，他将$r/s$映作$r/s$. 对于满同态的部分，任取$r/s'\in {S'}^{-1}R$，由于$s'$是某个$s\in S$的因子，于是$s't'=s$，其中$t'\in S'$，所以$r/s'=rt'/(s't')=rt'/s$就是$r/s'$在$r/s$中的原像。

在文中，注意到$g^n=af$，$S_g=\{1$, $\cdots$, $g^n$, $\cdots\}$包含$g^{n+1}=afg$，所以$S'_g$中包含$fg$，故$S'_{fg}\subset S'_g$，反过来，由于$g$是$fg$的一个因子，所以$S'_g\subset S'_{fg}$，综上$S'_g=S'_{fg}$，故而$R_g=R_{fg}$.}
$R_f\to R_{fg}=R_g$. 由Proposition \ref{pro:1.1.12}，只要我们验证基本开集覆盖之间的层公理，这样就给出了一个层。在下面的Propostion \ref{pro:1.1.18}完成这个之前，我们先建立一个简单但是很基本的引理，它描述了仿射概形的基本开集的覆盖。

\begin{lem}\label{lem:1.1.16}
	令$X=\spec R$，以及$\{f_a\}$是一族$R$中的元素。于是开集族$X_{f_a}$是$X$的开覆盖当且仅当$\{f_a\}$生成单位理想。特别地，$X$是一个预紧拓扑空间。
\end{lem}

回忆\textit{预紧}指每一个开覆盖都有有限子覆盖，其中\textit{预}字指空间不一定是Hausdorff的。实际上，概形几乎从来不是Hausdorff的。因此不幸地，紧性的不少好性质在这里不好使了。比如，与紧流形上不同，从一个仿射概形到另一个仿射概形的连续像不一定是闭的。正是这个原因，我们将在\ref{sec:3.1}节中讨论一个被称为\textit{颇合性}的更好的“紧性”概念，它将在概形理论中担任起寻常几何理论中的紧性的重要作用。

\begin{proof}
	$X_{f_a}$覆盖$X$当且仅当没有$R$的素理想包含所有的$f_a$，也当且仅当$f_a$生成单位理想，这就证明了第一个命题。为了证明第二点，首先注意到每一个开覆盖都可以加细成$X=\bigcup X_{f_a}$的形式，其中没有$f_a\in R$. 因为$X_{f_a}$是$X$的开覆盖，所以$f_a$生成单位理想，于是$1$可以写成（必然是有限个）$f_a$的线性组合。仅取线性组合中出现的$f_a$，它们也是$X$的开覆盖。于是原本的开覆盖就有了一个有限子覆盖。
\end{proof}

\begin{exe}
	如果$R$是一个Noether环，$\spec R$的每一个子集都是预紧的。
\end{exe}

\begin{pro}\label{pro:1.1.18}
令$X=\spec R$，并设$X_f$被开集$X_{f_a}\subset X_f$所覆盖。
\begin{compactitem}
\item[{\rm (a)}] 如果$g$, $h\in R_f$在每个$R_{f_a}$中相同，则$g=h$.
\item[{\rm (b)}] 如果对每一个$a$，都存在一个$g_a\in R_{f_a}$使得对每一对$a$, $b$，$R_{f_af_b}$中$g_a$与$g_b$的像都相同，则存在一个$g\in R_f$使得$g$在每个$R_{f_a}$中的像是$g_a$.
\end{compactitem}
\end{pro}

等价地，如果$\mathscr{B}$是$\spec R$的一个基本开集族，如果我们置$\oo_X(\spec R_f):=R_f$，于是$\oo_X$是一个$\mathscr{B}$\hyp 层。由Proposition \ref{pro:1.1.12}，$\oo_X$将可以唯一扩张成$X$上的一个层。

\begin{defi}
	上面一个命题中定义的层$\oo_X$被称为$X$的\textit{结构层}或者$X$上的\textit{正则函数层}。
\end{defi}

\noindent\textit{Proposition \ref{pro:1.1.18}的证明}. 我们从$f=1$开始，此时，$R_f=R$以及$X_f=X$.

对第一部分，观察到如果$g$和$h$在每一个$X_{f_a}$上相同，则$f_a$的某个幂乘上$g-h$为零。由Lemma \ref{lem:1.1.16}，我们可以假设这个开覆盖是有限的，这就意味着，存在一个正整数$N$使得所有$f_a^N$生成的理想都是$g-h$的零因子。但是，这个理想包含了所有$f_a$生成的理想的某个幂次
\footnote{译者注：假设指标$a$一共有$n$个，设$f_a$生成的理想是$\mathfrak{a}$，则$\mathfrak{a}^{nN}$中的元素由形如$f_1^{k_1}\cdots f_n^{k_n}$生成，并且满足$\sum_{i=1}^n k_i=nN$，因此至少有一个$k_i\geq N$，进而$\mathfrak{a}^{nN}(g-h)=0$.}
，而所有$f_a$生成单位理想，因此$g=h\in R$.

对于(b)部分，我们将用一个类似于经典的单位分解的命题将局部的$g_a$拼成一个整体的$g\in R$. 对一个足够大的$N$，$f_a^Ng_a\in R_{f^a}$是某个$h_a\in R$的像，从Lemma \ref{lem:1.1.16}，我们可以假设覆盖$\{X_{f_a}\}$是有限覆盖，于是对所有的$a$都可以选一个相同的$N$. 接着，因为$g_a$和$g_b$在$X_{f_af_b}$中的像相同，则对足够大的$N$必有
\[
	f_b^Nh_a=(f_af_b)^Ng_a=(f_af_b)^Ng_b=f_a^Nh_b.
\]
同样因为已经假设$\{X_{f_a}\}$是有限覆盖，所以对所有的指标，都可以选成一个$N$. 从Lemma \ref{lem:1.1.16}，$f_a\in R$生成单位理想，于是$f_a^N$也生成单位理想\footnote{译者注：注意到$X_{f_a^N}=X_{f_a}$是$X$的一个覆盖。}，于是我们可以记
\[
	1=\sum_a e_a f_a^N,
\]
其中系数$e_a\in R$，这就是我们的单位分解。我们下面证明
\[
	g=\sum_a e_ah_a
\]
就是我们所寻找的$R$中的元素。事实上，对每一个$b$，在$R_{f_b}$中我们有
\[
	f_b^N g =\sum_a f_b^N e_ah_a=\sum_a f_a^N e_a h_b=h_b=f_b^N g_b,
\]
于是$g$限制在$X_{f_b}$上等于$g_b$，正如我们所希望的。

回到任意$f$的情况，令$X'=X_f$, $R'=R_f$, $f'_a=ff_a$，所以$X'=\spec R'$以及$X'_{f'_a}=X_{f_a}$. 于是可以应用已证明的情况来证明最初的命题。
\qed

如果将$R_f$和$R_{f_a}$分别换成$M_f$和$M_{f_a}$，其中$M$是一个$R$\hyp 模，则基本完全相同的证明告诉我们命题依然成立。

\begin{exe}\label{exe.1.20}
描述下面概形的点集与函数层：
\[
\begin{array}{rlcrl}
\text{(a)} & X_1=\spec \cc[x]/(x^2).    &\quad & \text{(b)} & X_2=\spec \cc[x]/(x^2-x).\\
\text{(c)} & X_3=\spec \cc[x]/(x^3-x^2).&\quad & \text{(d)} & X_4=\spec \cc[x]/(x^2+1).
\end{array}
\]
\end{exe}

与许多几何理论相反（尽管类似于在复流形范畴中的情况），一个概形可能只有很少的正则函数。例如，在我们定义任意的概形时将看到，与紧流形类似的概形上面根本没有非常值的正则函数。因此，在概形$X$上部分地定义的函数，即一个稠密开集$U$上的$\oo_X(U)$中的元素，发挥了巨大的作用。他们被称为$X$上的\textit{有理}函数\index{有理!函数}，因为当$X=\spec R$而$R$是一个整环，以及$U=X_f$时，$\oo_X(X_f)=R_f$的元素是$R$中元素的分式。在最感兴趣的情况下，我们将看到$X$中的每一个非空开集都是稠密的，于是有理函数的表现将反应$X$的整体性质。

\begin{exe}
令$\mathscr{U}$是$X$中的稠密开集族，计算\textit{有理函数环}
\[
	{\varinjlim}_{U\in \mathscr{U}}\oo_X(U):=
	\left\{\parbox{30em}{
			对$U\in\mathscr{U}$的不交并$\oo_X(U)$，模掉等价关系$\sigma\sim \tau$：若$\sigma\in\oo_X(U)$, $\tau\in\oo_X(V)$限制在包含于$U\cap V$中的某个$W\in\mathscr{U}$上是相同的
		}\right\},
\]
首先对整环计算，然后对任意的Noether环计算。
\end{exe}

\begin{exa}
另一个非常简单的例子可能有助于牢记这些想法。令$K$是一个域，而$R=K[x]_{(x)}$是以$x$为单变量的多项式环在极大理想$(x)$处的局部化。概形$X=\spec R$只有两个点，$R$的两个素理想$(0)$和$(x)$. 作为拓扑空间，他只有三个开集
\[
	\varnothing\subset U:=\{(0)\}\subset \{(0),(x)\}=X.
\]
$U$和$\varnothing$是基本开集，因为$\{(0)\}=X_x$. 层$\oo_X$于是很容易描述。它具有值$\oo_X(X)=R=K[x]_{(x)}$以及$\oo_X(U)=K(x)$，其中$K(x)$是有理函数域。从第一个到第二个的限制映射就是自然的含入同态。
\end{exa}

\begin{exe}
	给出概形$\spec K[x]$的结构层一个类似的完全描述。（答案将在第\ref{chap:2}章给出。）
\end{exe}