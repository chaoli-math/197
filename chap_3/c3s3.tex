\section{射影概形的不变量}\label{s:3.3}

在本节中，我们假设$K$是一个域，并且只在$K$-概形上工作，
除非明确提及相反的情况。

假设给定了射影空间中的一个概形，我们如何找到它的不变量？
最简单的想法是问：有多少独立的$d$-次型%
\footnote{译者注：一个$\nu$-次齐次多项式定义的函数被称为
一个$\nu$-次型（form），有时候干脆就把一个齐次多项式称为型。
这点依赖于语境。}%
在上面为零？把对不同的$d$的答案放在一起，
我们得到了以前被称为概形的假设的东西
（可能是因为当时人们对这些数给定的概形感兴趣）。 
现在，通常以等效形式的Hilbert函数来讨论这些信息。
我们将在这里讨论Hilbert函数方法的几种变体，
这些变体产生了一大类不变量。有些生成的不变量实际上
仅依赖于抽象概形，而不依赖于给定的射影嵌入，而其他的不变量则
依赖于嵌入; 所以我们将一路评注这些事情。我们采用的思路%
% p.125
就是最初Hilbert [1890]使用的，而不是更被广为采用Samuel的
（比如可见Hartshorne [1977, Chapter I]）。 Hilbert的方法
要求稍多一些的技巧但是能给出一个更强且更易理解的结果。

我们从定义基本的不变量开始。在这章的最后部分，我们将展示
一些简单的几何示例，说明不变量包含哪些信息。

\subsection{Hilbert函数与Hilbert多项式}\label{s:3.3.1}

首先，假设我们给定了一个闭子概形$X\subset \mathbb P^r_K$，
其由一个饱和理想$I=I(X)\subset S=K[x_0,\dots,x_r]$描述，
如Example \ref{exe:3.14} 所定义的那样。假设，齐次多项式
$F_1$, $\dots$, $F_n$生成了$I$. 记$R=S/I(X)$是$X$的齐次
坐标环，再记$R_\nu$是$R$的$\nu$-次齐次分量。

这里基础的想法是对应$X\subset \mathbb P^r_K$给一个函数
\[
	H(X,\cdot):\mathbb N\to \mathbb N,
\]
它被称为$X$的\textit{Hilbert函数}，由
\[
	H(X,\nu)=\dim_K R_\nu
\]
定义。更一般地，如果$M$是任意的有限生成分次$S$-模，我们
定义它的Hilbert函数为$H(M,\nu):=\dim_K M_\nu$. 下面是基本的
结论。

\begin{thm}[Hilbert]\label{thm:3.55}
存在唯一的$\nu$的多项式$P(X,\nu)$使得$H(X,\nu)=P(X,\nu)$对
所有足够大的$\nu$都成立。更一般地，对任意的有限生成分次$S$-模
$M$，存在一个唯一的多项式$P(M,\nu)$使得$H(M,\nu)=P(M,\nu)$对
所有足够大的$\nu$都成立。
\end{thm}

我们将在下面指出如何证明这一点（沿着Hilbert最初的证明
[1890]的思路）。

多项式$P(X,\nu)$称作$X$的\textit{Hilbert多项式}。就像在经典簇
中一样，它携带了概形$X$的基础信息。比方说，我们将看到它的次数
就是$X$的维数，当$X$是零维时，它的（常数）值就是$X$的度。
更一般地，我们定义$K$上的射影空间的任意$n$-维子概形$X$
的度为$n!$乘以$X$的Hilbert多项式的首项系数；这允许我们将经典的
簇的度推广到更大一类子概形$X\subset \mathbb P^r_K$上。

\subsection{平坦性 II：射影概形族的极限}\label{s:3.3.2}

Hilbert多项式的另一意义在于它给了我们平坦这个概念的几何解释。

% p.126

\begin{pro}\label{pro:3.56}
在约态连通基$B$上的射影空间的闭子概形族
$\mathscr X\subset \mathbb P_B^r$是平坦的当且仅当其所有纤维
具有相同的Hilbert多项式。
\end{pro}

一般情况的证明将把我们扯得太远，但是这个结论在
$B=\spec K[t]_{(t)}$时是简单的。

\begin{proof}[{当$B=\spec K\lbrack t\rbrack_{(t)}$时的证明}]
闭子概形$X\subset \mathbb P_K^r\times B$由
\[
	K[t]_{(t)}[x_0,\dots,x_r]
\]
中的理想$I$给出，且$I$对于$x_0$, $\dots$, $x_r$是齐次的。
因此齐次坐标环
\[
	R=K[t]_{(t)}[x_0,\dots,x_r]/I
\]
的每个分次部分都是一个$K[t]_{(t)}$-模。

我们已经知道，族$X\to B$是平坦的当且仅当每个局部环$\oo_{X,x}$
是$K[t]_{(t)}$-无挠的。这等价于说，如果我们让任意$x_i$是可逆的%
\footnote{译者注：这里意思应该是形式可逆，即考虑局部化。}%
，则$R$的挠子模将趋于零。于是，挠子模乘上理想
$(x_0,\dots,x_r)$的某个幂为零，而因此只与$R$的有限个分次部分
相交。但是如果$R_\nu$是$R$的一个分次部分，从$K[t]_{(t)}$是一个
主理想环以及$R_\nu$是一个有限生成$K[t]_{(t)}$-模，$R_\nu$是
无挠的当且仅当它是自由的。此外，$R_\nu$是自由的，如果他需要的
生成元个数，从Nakayama引理为
\[
	\dim_K R_\nu \otimes_{K[t]_{(t)}}K
\]
应该等于它的秩
\[
	\dim_{K(t)}R_\nu  \otimes_{K[t]_{(t)}}K(t),
\]
即，当且仅当$H(X_{(0)},\nu)$的值等于$H(X_{(t)},\nu)$的值，其中
$X_{(0)}$和$X_{(t)}$是族$X$在$B$的两个点$(0)$和$(t)$处的纤维。
（同时，Hilbert函数是常数当且仅当仿射锥族$\spec R$在$B$上是
平坦的。）
\end{proof}

这个命题告诉我们，射影概形的闭子概形的平坦族表现得比一般的
平坦族要好。比如，尽管一个仿射概形的非空子概形族的平坦极限
可能是空的，但这命题告诉我们，射影空间的子概形族的平坦极限
不会这样。这点连同单参闭子概形族平坦极限的存在和唯一性（
第 \ref{s:2.3.4} 节和第 \ref{s:2.3.4} 节），给出了一种证明
射影概形是逆紧的思路，使用所谓的“赋值判别法”。所有这些，
可见，比如，Hartshorne [1977, Chap. II].

当然，$H(X,\nu)$比$P(X,\nu)$包含了更多信息，似乎$P(X,\nu)$
作为一个只有有限个系数的多项式，比起整个Hilbert函数更容易% 
% p.127
操作。但实际上，使用二项式系数，Hilbert函数也有一个有限的
表达式。为看到这点，我们将引入一组更好的不变量，\textit{
$R$的自由分解的分次Betti数}，使用它，Hilbert函数和Hilbert
多项式都可以被改写为更方便的形式。（Hilbert多项式比起
Hilbert函数真正的优点是它包含的信息依赖于稍少一些的 ---
下面我们会详细阐述 --- $X$的嵌入细节。）

\subsection{自由分解}\label{s:3.3.3}

我们将记$S(-b)$为具有次数为$b$的生成元的秩为$1$的分次自由模；
这里显然不幸的符号选取由更方便和容易记忆的公式
\[
	S(-b)_\nu =S_{\nu-b}
\]
所补偿。下面我们将用分次自由模来分解$R$，或实际上任意的分次
$S$-模，这里分次自由模是形如$S(-b)$的模的拷贝的直和。

假设$F_1$, $\dots$, $F_n$是$M$的齐次生成元的极小集，我们将记
$b_{0j}$为$F_j$的次数。定义一个满射
\[
	\varphi_0:E_0:=\bigoplus_{j=1}^n S(-b_{0j})\to M
\]
通过将$S(-b_{0j})$的生成元映射到$F_j\in M$. 令$M^{(1)}$为
$\varphi_0$的核。如果$M^{(0)}$非零，我们可以用$M^{(1)}$代替
$M$（它应被叫做$M^{(0)}$）重复操作；选一个$E_0$的极小齐次元组
$e^{(1)}_i$生成了$M^{(1)}$，$e^{(1)}_i$的次数为$b_{1i}$，我们
将一个生成元次数分别为$b_{1i}$的分次自由模映射到$M_1$，通过
\[
	\varphi_1:E_1:=\bigoplus_{j=1}^n S(-b_{1j})\to E_0
\]
将$E_1$的第$i$个生成元映射到$e_i^{(1)}$. 继续这样做下去，我们
得到了一个分解
\[
	E:\cdots \longrightarrow E_i 
	\xrightarrow{\,\,\varphi_i\,\,} E_{i-1}
	\longrightarrow \cdots  \xrightarrow{\,\,\varphi_1\,\,}
	E_0,
\]
其中
\[
	E_{i}=\bigoplus_j S(-b_{ij}).
\]
当然，这个过程在某个$\varphi_i$为单射时候就停止了，Hilbert的
重要发现即，如果$S$是多项式环，这总是会发生的。

% p.128

\begin{thm}[Hilbert合冲定理]
令$S=K[x_0,\dots,x_r]$. 在上面的任意极小自由分解中，对某个
$i\leq r+1$，即某个小于变量个数的数，$\varphi_i$是一个单射，
特别地，任意分次$S$-模有一个有限、分次、自由分解。
\end{thm}

这里我们将不证明这点，见Hilbert [1890]，或更现代的陈述，
Eisenbud [1995, Section 1.10, Chap. 19] 或 
Matsumura [1986, Theorem 19.5].
合冲定理让我们可以证明Theorem \ref{thm:3.55}.

\begin{proof}[{Theorem \ref{thm:3.55} 的证明}]
模$S(-b)$的Hilbert函数是容易写出的。因为
\[
	S(-b)_\nu=S_{\nu-b}
\]
有一个基包含所有的次数为$\nu-b$的$r+1$变量首一多项式，所以
\[
	H(S(-b),\nu)=\binom{r+\nu-b}r,
\]
其中二项式系数当下面的数大于上面的时候为零。对$\nu\geq b-r$
时候，它与多项式
\[
	P(S(-b),\nu)=\frac{(r+\nu-b)(r+\nu-b-1)\cdots (\nu-b)}
	{r(r-1)\cdots 1}
\]
相同，所以我们看到$H(X,\nu)$对大$\nu$来说是一个多项式。

作为$S$-模，从$M$的一个有限、自由分解
\[
	E:0 \longrightarrow E_{r+1} 
	\xrightarrow{\varphi_{r+1}}E_{i}
	\longrightarrow \cdots  \longrightarrow E_1 
	\longrightarrow M \longrightarrow 0,
\]
其中
\[
	E_i=\bigoplus_j S(-b_{ij}).
\]
我们看到，$M$的Hilbert函数可以被写为
\[
	H(M,\nu)=\sum_{i=0}^r (-1)^i H(E_i,\nu)
	=\sum_{i=0}^r(-1)^i\sum_j H(S(-b_{ij}),\nu)
\]
的形式。因为我们已经说明了，每个$H(S(-b_{ij}),\nu)$
对大$\nu$是一个多项式，所以$H(M,\nu)$对大$\nu$也是多项式，
这就是我们需要的。Theorem \ref{thm:3.55} 得证。
\end{proof}

显然，Hilbert函数和多项式是$X\subset \mathbb P_k^r$的不变量，
但\textit{分次Betti数}$b_{ij}$是不变量可能并不如此显然。这
来自于Nakayama引理，比如可见，Eisenbud [1995, Chap. 19] 或者
Matsumura [1986, Section 19] 上关于局部环上的极小自由分解的
讨论，它可以直接翻译到分次的情况。

因此，我们有了射影概形的三族逐步减弱的不变量：分次Betti数、
Hilbert函数以及Hilbert多项式。为方便读者，我们将列出关于它们
的一些事实，这些事实并不会在这里证明，同样也不会有必要的使用，
接着我们会给一些例子。

(1) 已经提到过，多项式$P(X,\nu)$的次数$d$是$X$的维数。

(2) 首项形如
\[
  \frac{\delta(X)}{d!}\nu^d,
\]
其中$\delta(X)$被称为$X$的\textit{度}。它可以等同于$X$与
$\mathbb P_K^r$的一个$r-d$维一般平面的相交子概形的长度。
（比如可见，Hartshorne [1977, Chapter I, 7.3 and 7.7].）
这来自于下面将会证明的观察（Proposition \ref{pro:3.59}），
$\mathbb P_K^n$中度为$\delta$的零维子概形的Hilbert多项式
为常多项式$\delta$，以及如果$Y$是$X$的一个一般的超平面截面，
则$Y$的Hilbert多项式为$X$的Hilbert多项式的一阶差分，即
\[
  P(Y,\nu)=P(X,\nu)-P(X,\nu-1).
\]

(3) 用第 \ref{s:3.2.5} 节的关于到射影空间的映射的刻画，
子概形$X\subset \mathbb P_K^r$的Hilbert多项式仅依赖于嵌入
$X\hookrightarrow \mathbb P_K^r$对应的可逆层$\mathscr L$，
而不依赖于特定的满射$\mathscr O_X^{r+1}\to \mathscr L$. 
实际上，对熟悉凝聚层的上同调的读者，对所有的$\nu$，
$P(X,\nu)$等于上同调群维数的交错和
\[
  \chi(\mathscr L^{\otimes nu})=\sum (-1)^i \dim_K H^i
  (X,\mathscr L^{\otimes \nu}).
\]
特别地，$P(X,0)=\chi(\mathscr O_X)=\sum (-1)^i \dim_K
H^i(\mathscr O_X)$是一个仅依赖于$X$而不依赖于嵌入！当$X$是
复数域上的非奇异曲线（即Riemann面），数
\[
  \dim_K H^1(\mathscr O_X)=g=1-P(X,0)
\]
是$X$的\textit{亏格}，因而$1-P(X,0)$是任意一维概形的亏格的
正确概念。这被称为概形的\textit{算术亏格}。在$X$的维数$d$大于
$1$的情况，第一感会觉得一般情况是$H^1(\mathscr O_X)=0$对
$1< i < d$成立（以及这个上同调群在$i>d$恒为零），于是$X$的算术
亏格可类似定义为$1+(-1)^d P(X,0)$.

(4) $\mathbb P_K^r$中所有Hilbert多项式等于同一给定概形的簇的
全体，可以自然等同于一个射影概形的$K$-值点的集合，它被称为
对应于给定多项式的\textit{Hilbert 概形}. 比方说，任意Hilbert
多项式为$P(\nu)=\binom{\kappa+\nu}{k}$（即一个$k$-平面
的Hilbert多项式）的子概形$X\subset \mathbb P_K^r$实际上就是一个
$k$-平面，因此所有这样的子概形的Hilbert概形就是Grassmannian%
% p.130
$\mathbb G(k,r)=G(k+1,r+1)$. 然而，可以在几何上理解的
Hilbert概形的其他情况并不多见！我们将在最后一章的
第 \ref{s:6.2.2} \nottran 节回到这个构造。

\begin{exe}\label{exe:3.58}
令$A$是一个Noether环，而$\mathscr X$是一个$\mathbb P_A^n$的
闭子概形，可将其视作$\spec A$上的一个概形族。因为$\mathscr X$
在点$p\in \spec A$的纤维$X_p$是$\mathbb P_{\kappa(p)}^n$的一个
闭子概形，它有一个Hilbert函数$H(X_p,\nu)$. 证明函数$H(X_p,\nu)$，
看成$p$的函数，在$\spec A$的Zariski拓扑中是上半连续的，
即对任意$\nu$和数$m$，
\[
	\{p\in \spec A\;:\; H(X_p,\nu)\geq m\}
\]
是一个$\spec A$的闭子集。
\end{exe}

我们可将Hilbert 多项式的定义推广到任意不可约基$S$上的射影空间
的子概形$X\subset \mathbb P_S^r$上，通过定义$P(X,\nu)$为$X$
在$S$的一般点上的纤维的Hilbert多项式。这并没有引入任何新东西，
--- 由第 \ref{s:2.3.4} 中的一般平坦性定理以及 Proposition 
\ref{pro:3.56}，或由 Exercise \ref{exe:3.58}，$X$将在一个稠密
开子集$U\subset S_{\text{red}}$上平坦，于是$P(X,\nu)$就是$X_U$
在$U$上的纤维的寻常的Hilbert多项式 --- 但这是方便的术语。

(5) 在许多方面，由分次Betti数给出的不变量是最微妙的，
直到最近，除了Hilbert函数和多项式之外，
没有人知道它的几何意义。然而，今天我们知道，在一些情况下
（以及更多的猜想），它们如何反映了$X$内蕴几何的一些微妙性质。
更多信息比如可参见Green [1984]; Green and Lazarsfeld [1985].

\subsection{例子}\label{s:3.3.4}
\paragraph*{平面上的点}
\addcontentsline{toc}{subsubsection}{平面上的点}
对平面上的零维子概形，我们已然可从Hilbert多项式、Hilbert函数
和分次Betti数得到不同的信息。

首先，我们在上面说过了，子概形$X\subset \mathbb P_K^r$的
Hilbert多项式的次数等于$X$的维数；所以当$X$是零维的时候，
Hilbert多项式是一个常数。在点的情况中，我们可以容易地证明
它以及更多。

\begin{pro}\label{pro:3.59}
  一个度为$\delta$的$\mathbb P_K^r$的零维子概形的Hilbert
  函数对所有的$\nu$满足
  \[H(X,\nu)\leq \delta,\]
  且对大$\nu$上式取等号。因此，$P(X,\nu)\equiv \delta$.
\end{pro}

\begin{proof}
我们要证明，$K[x_0,\dots,x_r]$中在$X$上为零的$\nu$-次型
的集合的余维数，即$\codim I(X)_\nu$，小于或等于$\delta$，且对
大$\nu$是等式。理由是，多项式在一点上为零是其系数的线性条件，
于是在$X$为零对应$\delta$个线性条件；对大$\nu$，我们将证明
这些条件永远是线性无关的。

为明确之，我们转进到仿射开集的情况。改变坐标，我们可以假设$X$
包含于$x_r\neq 0$的仿射开集中，于是一个$\nu$-次型
$F$属于$I(X)$当且仅当$F(x_0,\dots,x_r,1)$属于$X$在$x_r\neq 0$
的仿射开集的理想$J\subset K[x_0,\dots,x_{r-1}]$中。称$X$的长度
为$\delta$，就是说$J$在$K[x_0,\dots,x_{r-1}]$中的余维数为
$\delta$，因此，余维数小于等于$\delta$的多项式属于可以写成
$F(x_0,\dots,x_{r-1},1)$的$\nu$-次多项式$F$构成的空间中，而这
即是$K[x_0,\dots,x_{r-1}]$中次数小于等于$\nu$的多项式
构成的空间。这立刻说明$H(X,\nu)\leq \delta$对所有$\nu$成立，
且当$J$在次数小于等于$\nu$的多项式空间中的余维数为$\delta$时取
等号。但是，想要$J$在次数小于等于$\nu$的多项式空间中的余维数为
$\delta$，只要能从中找到一族$K[x_0,\dots,x_{r-1}]/J$的代表元
即可，这在所有足够大的$\nu$的情况总是成立的。
\end{proof}

如果$X\subset \mathbb P_K^r$非空，$I(X)$不包含任意零次元（我们
在域上工作！），所以$H(X,0)=1$. 因此，这个命题给出了一个
$P(X,0)\neq H(X,0)$的简单例子。

我们可以容易给出一族$\mathbb P_K^2$的子概形，它们有相同的
Hilbert多项式但不同的Hilbert函数。为构造这样的一个族
$\mathscr X\subset \mathbb P_K^2\times \spec K[t]$，比如，我们
可以取“常值”点$P$和$Q$，分别由$(x_2=x_1+x_0=0)$和
$(x_2=x_1-x_0=0)$给出，以及由$(x_1=x_2-tx_0)$给出的
跑动的点$R$，再令$\mathscr X$为$P$, $Q$, $R$在$\mathbb P_K^2
\times \spec K[t]$中的（不交）并。
\inclugra{3.png}% 
% p.132
通过投影的第二个因子，我们将$\mathscr X$看成一个$\spec K[t]$
上的平坦族，其在一般点和每个闭点$(t-\lambda)$上的纤维
$X_{(0)}$和$X_\lambda$（分别作为$K(t)$和$K$上的概形）有着
Hilbert多项式$P(X_{(0)},\nu)=P(X_\lambda,\nu)\equiv 3$，但对
$\lambda =0$有Hilbert函数$H(X_{\lambda},1)=3$，而$H(X_0,1)=2$.

\begin{exe}\label{exe:3.60}
令$\tilde{X}_{\lambda}\subset \A_K^3$为上面的族$\mathscr X$的
纤维$X_\lambda$上的锥。证明，不存在平坦族$\tilde{\mathscr X}
\subset \A_K^3\times_K \spec K[t]$，其在每个点$(t-\lambda)$上
的纤维是$\tilde{\mathscr X}_\lambda$. （但在$\spec K[t]$的
补集上存在这样的一个族。）锥$\tilde{\mathscr X}_\lambda$在
$\lambda$趋向于$0$时候的平坦极限是上面？（见第 \ref{s:2.3.4}
节的例子。）
\end{exe}

现在考虑当$X$是平面$\mathbb P_K^2$上四个不同点的情况。我们已经
知道$P(X,\nu)\equiv 4$. 下面将分别处理，所有点都在一条直线上
或者除了一点外全在一条直线上的情况。

(1) \textit{$X$处于一条直线上}。首先假设，点都处于方程为$l=0$
的直线$L$上。唯一包含$X$的直线是$L$，于是
\[
	H(X,1)=H(\mathbb P_K^2,1)-1=2.
\]
如果$q=0$是一个包含$X$的锥的方程，则$q$限制在$L$上是一个
二次型，在$X$的四点处为零，于是$q$必须在$L$上为零。因此，
$q=0$是$L$与另一条直线的并，而包含$X$的锥的方程的集合是
$l$乘以一个一次型构成的三维空间。这给出了
\[
	H(X,2)=H(\mathbb P_K^2,2)-3=3.
\]

然而你，从$\nu=3$开始，在四点为零给出了$\nu$-次型的四个独立
条件，于是$H(X,\nu)=4$. 为证明这点，只需对$X$的每个
三点集$X'$，找一个度为$\nu$的曲线包含$X'$但不包含$X$的
第四个点。而这可以通过找$\nu$条直线，其中三条分别穿过$X'$的
一个点，而剩下的远离$X$，则包含这$\nu$条直线的曲线
即我们需要的。

\inclugra{4.png}
% p.133

为计算这个以及下个例子的极小自由分解，我们将使用一个Hilbert
的结果，他被Lindsay Burch推广到了局部情况。

\begin{thm}\label{thm:3.61}
如果$I$是一个零维子概形$X\subset \P_K^2$的齐次理想，则齐次
坐标环$S/I$的任意极小自由分解都具有形式
\[
	0\longrightarrow \sum_{j=1}^{n-1}S(-b_{2j})
	\xrightarrow{A}\sum_{j=1}^{n}S(-b_{1j})
	\longrightarrow S.
\]
此外，$I$的第$j$个生成元，即$S(-b_{1j})$在$S$中的像，
与矩阵$A$删去第$j$列的行列式只差一个非零标量。
\end{thm}

证明比如可见 Eisenbud [1995, Section 20.4].

下面的推论将用这个定理来计算理想$I(X)$的极小生成元。

\begin{coro}\label{coro:3.62}
如果$I$是一个零维子概形$X\subset \P_K^2$的齐次理想，且
如果$I$包含了一个$e$-次元素，则$I$可以由$e+1$个元素生成。
\end{coro}

\begin{proof}
如果$I$的极小生成元个数为$g$，那么$I$可以由一个矩阵$A$
的$(g-1)\times (g-1)$行列式所生成，其中$A$的元素都在$S$的分次
极大理想中，进而也都是正次型。所以，$I$中没有元素的次数小于
$g-1$，于是我们有$g\leq e+1$，此即所需。
\end{proof}

从定理，知道矩阵$A$的元素的次数等价于知道该情况中的分次
Betti数：$b_{ij}$就是$A$的子式的次数，而$b_{2j}$就是$b_{1j}$
加上$A$第$i$行第$j$列元素的次数。

将这点应用到手头上的例子，我们看到，因为$X$处于一条直线上，
$I(X)$可以由两个元素所生成，它们当然可被取作$L$和$I$中
一个不能被$L$整除的最小可能次数的型。

\inclugra{5.png} 

已经说过，这个最小可能的次数为$4$，故我们可比如取$F$为一个
包含四条直线的四次方程，每一条穿过$X$的一个点。
% p.134
\inclugra{6.png} 

因为$L$和$P$没有公共因子，我们看到，$S/I(X)$的极小自由分解
具有形式
\[
	0\longrightarrow S(-5)\longrightarrow S(-4)\oplus
	S(-1)\longrightarrow S,
\]
给出了Hilbert函数的表达式
\[
	H(X,\nu)=\binom{\nu+2}{2}-\binom{\nu+1}{2}
	-\binom{\nu-2}{2}+\binom{\nu-3}{2}.
\]

(2) \textit{$X$除了一点外都在一条直线上}。
接着，考虑四点中只有三点在一条直线$L$上的情况。现在，$I(X)$
中没有一次型了，所以$H(X,1)=3$.

\inclugra{7.png} 

所有包含$L$上的三个点的二次型都必须，如之前的断言，包含$L$，
所以任意包含$X$的二次型是$L$和一条穿过第四个点的直线的并。
因为对应于穿过第四点的直线的一次型的空间是二维的，则包含$X$
的二次型的空间也是二维的，故我们有$H(X,2)=4$. 重复之前相同的
论断，我们可以证明$H(X,\nu)=4$对所有大$\nu$都成立，于是这里
是对所有$\nu\geq 2$的情况都成立。

% p. 135

对于分解，我们从上面的推论看到，$I(X)$至少需要三个生成元。但是
$I(X)$并不由其包含的两个独立二次型所生成，因为它们有一个
公共因子，于是，他的极小生成元集包含被二次型，还有一个其他的
生成元，它是不包含于两个二次型生成的理想中的最低可能次数型，
或者等价地，在不包含$L$的某个曲线上为零。不难看到，存在一个三次
曲线满足想要的性质，他可以被取作，比如，为三条直线的并，其中
每条直线穿过$L$上的点，而另一条穿过第四点。因为$I(X)$的极小生成元
集的次数分别为$2$, $2$, $3$，矩阵$A$必然是一个$2\times 3$矩阵，
其生成元的次数由下图给出（至多差一个行和列的重排）
\[
	\begin{pmatrix}
	1&2\\
	1&2\\
	0&1
	\end{pmatrix}.
\]
（当然，次数为$0$的元素必须就是$0$，因为所有的元素都必须包含于
极大分次理想中。）因此，极小自由分解具有形式
\[
	0\longrightarrow S(-3)\oplus S(-4)\xrightarrow{4}
	S(-2)\oplus S(-2)\oplus S(-3)\longrightarrow 0.
\]

(3) \textit{$X$的任意三点都不处于一条直线上}。最后，考虑$X$包含了
四个点，其任意三点都不在一条直线上。我们断言，$X$的Hilbert方程和
之前的情况一样：$H(X,1)=3$, $H(X,\nu)=4$对$\nu\geq 2$. 其中第一
点是显然的，因为$X$并不在任意直线上。对第二点，像之前一样，只需
注意到，存在二次型（于是更高次型）包含四点的任意子集而不包含
最后一点，这可以同之前一样用直线的并来构造。

现在来计算$S/I(X)$的自由分解。取由四点给出的四次型的两对对边，
这给出两个二次型$q_1$和$q_2$，它们在$X$的理想中没有公共因子。
\inclugra{8.png} % p.136
因为$q_1$和$q_2$是互素的，它们生成的$I$的自由分解具有形式
\[
	0\longrightarrow S(-4)\xrightarrow{A}
	S(-2)\oplus S(-2)\xrightarrow{\;\;B\;\;} S,
\]
其中
\[
	B=\begin{pmatrix}
	q_1&q_2
	\end{pmatrix}
	\quad
	A=\begin{pmatrix}
	-q_2\\
	q_2
	\end{pmatrix}.
\]

从这个分解计算$S/I$的Hilbert函数，我们看到他与$S/I(X)$的一样，
因为$I\subset I(X)$，我们必然有$I=I(X)$，即$I$由$q_1$, $q_2$
生成，而$X$对应于两个包含它的锥的交。

总之，我们看到所有三个例子从Hilbert多项式角度来看都是相同的，
前两个例子由它们的Hilbert函数所区分，而后两个例子在Hilbert
函数上看是相同的，但是可以由它们的分次Betti数区分。对长度为
$4$的子概形$X$，可以由概形的不变量所区分，而不依赖于嵌入
的例子也是不难找到的。比方说，概形$\spec K[x]/(x^4)$可以
被嵌入到$\P_K^2$中使得有着上面的任意一个Hilbert函数和Betti数
（比方说，就像由理想$(x_0,x_1^4)$, 
$(x_0x_2^2-x_1^3,x_0x_1,x_0^2)$和$(x_0x_2-x_1^2,x_0^2)$
分别定义的子概形，由$(x_0^2,x_1^2)$定义的子概形
将永远有着第三种情况中的分次Betti数和Hilbert函数）。\nottran

\begin{exe}\label{exe:3.63}
找到平面上所有长度为$3$的子概形的Hilbert多项式、Hilbert函数以及
分次Betti数。
\end{exe}

\paragraph*{例子：一般的以及在
\texorpdfstring{$\mathbb P_K^3$}{PK3}中的双重直线}
\addcontentsline{toc}{subsubsection}{例子：一般的以及在
\texorpdfstring{$\mathbb P_K^3$}{PK3}中的双重直线}
至今，我们关于射影概形的讨论是平行于簇理论的。现在，我们将考察
一类真正非经典的例子。

Exercise \ref{exe:2.35} 让你证明了，所有的仿射双重直线是等价的。
这对射影双重直线不再正确。这里有一些简单的例子。

令$K$是一个域。考虑分次环
\[
	S=K[u,v,x,y]/(x^2,xy,y^2,u^dx-v^dy)
\]
以及概形
\[
	X=X_d=\proj S.
\]

为看到$X$是一个双重直线，我们构造一个$X$的仿射开覆盖。元素$x$,
$y$在$S$中是幂零的，于是由$u$, $v$生成的理想的根是$S$的无关理想，
同时$X$由$X_u$, $X_v$所覆盖。从定义，我们看到
\[
	X_u=\spec (S[u^{-1}])_0.
\]%
% p.137
为分析环$(S[u^{-1}])_0$，我们注意到，这是
\[
	K[u,v,x,y][u^{-1}]_0=K[v',x',y']
\]
的分式环，其中
\[
	v'=\frac vu,\quad x'=\frac xu,\quad y'=\frac yu,
\]
而映射到$(S[u^{-1}])_0$的核由$(x')^2$, $x'y'$, $(y')^2$和
$x'-(v')^dy'$所生成（见Exercise \ref{exe:3.6}）. 于是
\[
	(S[u^{-1}])_0\cong K[v',y']/(y')^2
\]
且$X_u$是一个仿射双重直线。由对称性，$X_v$也是，而这证明了$X$
是一个射影双重直线。具体地，
\[
	X_v\cong \spec (S[v^{-1}])_0
\]
以及
\begin{align*}
(S[v^{-1}])_0{}&\cong K[u'',x'',y'']/({x''}^2,x''y'',{y''}^2,
(u'')^dx''-y'')\\
{}&\cong K[u'',x'',y'']/({x''}^2),
\end{align*}
其中
\[
	u''=\frac uv=\frac 1{v'},\quad x''=\frac xv,\quad 
	y''=\frac yv.
\]

看到与仿射情况不同，不是所有的双重直线都同构的最简单方式是，
证明$X$的同构类依赖于整数$d$，其可以被想做给出了双重直线
绕着它的约态直线有多快。为证明它，我们将证明$X$的整体截面环
$\oo_X(X)$依赖于$d$. 为计算它，首先假设$\sigma\in \oo_X(X)$.
元素$\sigma$限制到$\oo_X(X_u)$，其同构于$K[v',y']/(y')^2$，
得到了一个元素
\[
	\sigma|_{X_u}=a(v')+b(v')y'
\]
以及类似地
\[
	\sigma|_{X_v}=f(u'')+g(u')x'',
\]
其中$a$, $b$, $f$和$g$都是唯一确定的$K$-系数多项式。但是，
在$X_u\cap X_v$上，我们有
\[
	u''=\frac 1{v'}
\]
以及
\[
	x''=\frac xv=\frac{x'u}v=(v')^d y'\frac uv=(v')^{d-1}y'.
\]
所以$f(1/v')=a(v')$，其只有当$f$和$a$都是常数多项式且$f=a$
才有可能。同样，$g(1/v')(v')^{d-1}=b(v')$，其只有当$g$和
$b$的次数都小于等于$d-1$（于是给出$g$和$b$的其中一个就确定了
另一个）。%
% p.138
反之，$\oo_X(X_u)$中任意形如$a+b(v')y'$的元素，其中
$a$是一个常数，而$b$是一个次数小于等于$d-1$的多项式，
可以唯一扩张为$\oo_X$的一个整体截面，所以$\oo_X(X)$的维数就是
$d+1$. 这证明了$X$的同构类依赖于$d$，如前所言。

实际上，我们在下面将看到整数$d$就是$X$的算术亏格的相反数，
算术亏格的定义见第 \ref{s:3.3.3} 节。事实证明，每个亏格为$-d$
的射影双重直线，其中$d\geq 0$，都同构于$X$.

同样，正的算术亏格的双重直线也存在，最简单的例子是
\textit{双重圆锥曲线} $\proj K[x,y,z]/(xy-z^2)^2$，它的
亏格是$3$，甚至在亏格大于等于$7$的时候，有这样双重直线的连续族。
这些对象在研究非奇异曲线的时候会自然出现：当一个非奇异非椭圆曲线
退化为超椭圆曲线，这是一个古典的簇理论中众所周知的现象，
一个典型的光滑曲线趋向于射影双重直线 \nottran 
（更多细节见Bayer以及Eisenbud [1995]和Fong [1993]）。

\begin{exe}\label{exe:3.64}
上面的双重直线$X$的$\oo_X(X)$的环结构是什么？
\end{exe}

\begin{exe}\label{exe:3.65}
对双重直线
\[
	X=\proj K[u,v,x,y]/(x^2,xy,y^2,p(u,v)x+q(u,v)y)
\]
求$\oo_X(X)$，其中$p$, $q$是任意在$\P_K^1$中没有公共零点的
两个$d$-次齐次多项式。证明，这个双重直线同构于示例的双重直线
（因此并不依赖于$p$和$q$的选取）。
\end{exe}

为计算$X$的Hilbert多项式，观察对每个$d$，理想$I_d=(x^2,xy,y^2,
u^dx-v^dy)$包含理想
\[
	I=(x^2,xy,y^2).
\]
因为$S/I$是一个自由$K[u,v]$-模，生成元是$1$, $x$和$y$，我们看到
\[
	H(S/I,\nu)=H(S/(x,y),\nu)+2H(S/(x,y),\nu-1).
\]
再进一步，用这组基，我们容易看到，如果记$p=u^dx-v^dy$
为上面写的$I_d$的第四个生成元，于是对任意的齐次型
$q=q(x,y,u,v)$，我们有$qp\in I$当且仅当$q\in (x,y)$. 因此
\[
	H(S/I_d,\nu)=H(S/I,\nu)-H(S/(x,y),\nu-d-1).
\]
但是$P(S/(x,y),\nu)=\nu+1$. 将这些等式连立起来，我们有
\[
	P(X,\nu)=2\nu+d+1,
\]
于是Hilbert多项式，特别地，算术亏格
\[
	p_a(X)=1-P(X,0)=-d,
\]
对不同的$d$的双重直线是不同的。

这有一个对以下三个例子有用的习题。

% p.139

\begin{exe}\label{exe:3.66}
计算下面的$\P_K^3$的子概形的Hilbert多项式：
\begin{compactenum}[(a)]
\item 两条异面直线的并。
\item 两条相交直线的并。
\item 一个底空间是两条交于一个度为$1$的嵌入点的直线的子概形，
且其并不处于这两条直线张成的平面上。同样，证明对双重直线$X_0$
上（活在上面的任意双重直线上）的任意点$p$，存在唯一的$\P_K^3$
的子概形包含$X_0$，在点$p$处有一个度为$1$的嵌入点，再计算这个
子概形的Hilbert多项式。
\end{compactenum}
\end{exe}

\begin{exe}\label{exe:3.67}
验证平坦极限$Y_0$就是双重直线$X_1$. （通过比较Hilbert多项式，
证明包含在一个方向就足够了。）\nottran
\end{exe}


\begin{exe}\label{exe:3.68}
对上面的$L$和$M_t$，证明在$t\to 0$时，$L\cup M$的平坦极限是
双重直线$x^2=y=0$，其在点$[0,0,1,0]$处有一个度为$1$的嵌入点。
\end{exe}

% p.140

\begin{exe}\label{exe:3.69}
令$L$, $M$和$N_t\subset \P_K^3$分别为直线$u=v=0$, $y=v=0$以及
$y+u=ty+(1-t)v=0$；令$Z_t$为它们在$\P_K^3$中的并。找到$Z_t$
和$Z_0$的Hilbert多项式。在上面讨论的意义下，概形$Z_t\subset 
\P_K^3$在$t\to 0$的极限是什么？
\end{exe}

\inclugra{9.png}

最后，存在上面三个例子的算术对应。比方说，考虑下面三族$\P_\zz^3$
的子概形（它们都在$\spec \zz$上平坦）：
\begin{compactenum}[(a)]
\item 令$\mathscr L\subset \P_\zz^3$为常直线$x=y=0$，再令
$\mathscr M\subset \P_\zz^3$为直线$x=7v$, $y=-7u$；令$\mathscr U$
为这两个子概形的并。
\item 令$\mathscr L\subset \P_\zz^3$为常直线$x=y=0$，再令
$\mathscr M\subset \P_\zz^3$为直线$x=7v$, $y=-49u$；令$\mathscr U$
为这两个子概形的并。
\item 令$\mathscr L$, $\mathscr M$和$\mathscr N\subset \P_\zz^3$
分别为由$u=v=0$, $y=v=0$和$y+u=7y-6v=0$定义的子概形，令$\mathscr U$
为它们的并。
\end{compactenum}

\begin{exe}\label{exe:3.70}
对上面的每个子概形$\mathscr U\subset \P_\zz^3$，找到
$\mathscr U$在点$(7)\in\spec \zz$处的纤维。
将你的答案与前面三个习题中的答案进行比较。
\end{exe}

\subsection{B\texorpdfstring{\'{e}}{é}zout定理}
\label{s:3.3.5}

B\'ezout定理最经典的形式是在说，如果由次数为$d$和$e$的
平面曲线$C$, $C'\subset \P_K^2$相交于有限点，其交点的个数
最多为$de$，如果两条曲线横截相交且$K$是代数闭的，则取等号。
这个重要的结果经历了一系列推广。特别是，概形的语言允许我们
给出一个既简单又比原来更通用的版本；尽管这个版本并不是最一般的，
但我们将专注于此。

% p.141
% p.142

\begin{exe}\label{exe:3.73}
令$K$是一个域，再令
\[
	B=\A_K^{12}=\spec K[a,b,c,d,e,f,g,h,i,j,k,l].
\]
考虑有下面两个圆锥曲线$\mathscr C_i\subset \P_B^2$
\begin{align*}
	\mathscr C_1&=V(aX^2+bY^2+cZ^2+dXY+eXZ+fYZ)\\
	&\subset \proj\left(
	K[a,b,c,d,e,f,g,h,i,j,k,l][X,Y,Z]
	\right)=\P_B^2
\end{align*}
以及
\[
	\mathscr C_2=
	V(gX^2+hY^2+iZ^2+jXY+kXZ+lYZ)\subset \P_B^2.
\]
通过考察投影
\[
	\pi_2:\mathscr C_1\cap \mathscr C_2
	\subset \P_B^2=\P_K^2\times_{\spec K}B
	\longrightarrow \P_K^2,
\]
证明$\mathscr C_1\cap \mathscr C_2$是一个不可约$K$-概形。
\end{exe}

% p.143
% p.144
% p.145
% p.146

\paragraph*{交点的重数}
\addcontentsline{toc}{subsubsection}{交点的重数}

% p.147
% p.148
% p.149

\subsection{Hilbert级数}\label{s:3.3.6}

% p.150
