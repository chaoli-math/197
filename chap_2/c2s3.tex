\section{非约态概形}

我们现在离开那些能被看作概形的对象，即仿射概形$\spec R$而$R$是有一个有限生成代数闭域上的代数，且没有幂零元。这里的现象将变得不再那么熟悉，我们需要在它们身上花费更多努力。

这类概形在一些足够简单的几何背景下就已经出现了：比如，下面处理的多重点已经作为两个寻常概形的相交或者作为映射“退化的”纤维出现了，正如Exercise \ref{exe:2.2} 中看到的。另一类非约态概形重要的应用是在一族簇的理论中（theory of families of varieties）：形变理论（deformation theory）以及模理论（moduli theory）。我们将解释如何对一族单参数的簇取极限，以及引入平坦性这一关键概念。最后，我们将给出一些非约态概形的例子，这些例子就它们自身而言都是有趣的对象。

从最简单的情况入手，我们将关注仿射空间$\mathbb{A}_K^n$的子概形，它的支集是原点 ------ 等价地，它由一个理想$I$给出，其零点集$V(I)$作为集合只包含$(0$, $\dots$, $0)$. （回忆一个概形的支集\footnote{译者注：我们会将`support at'翻译成“支于”或者“支撑于”，称一个概形支于$X$，就是说它的支集是$X$.}是指它的底空间。）

\subsection{双重点}\label{s:2.3.1}
\index{双重!点}
\begin{exa}
	此类概形最简单的例子是$\mathbb{A}_K^1$由理想$(x^2)$定义的子概形 ------ 即概形$\spec K[x]/(x^2)$，通过商映射$K[x]\to K[x]/(x^2)$诱导的映射看作$\mathbb{A}_K^1$的子概形。这个概形只有一个点，对应于理想$(x)$，但同样作为$\mathbb{A}_K^1$的子概形与作为抽象概形，这与概形$\spec K[x]/(x)=\spec K$不同。作为抽象概形，我们能看到存在如下差别，在$X$上存在非零正则函数（比如$x$）在$X$唯一一点处为零，当然任意这样的函数平方为零。差别在于，作为$\mathbb{A}_K^1$的子概形，$\mathbb{A}_K^1$上的函数$f\in K[x]$在$X$上为零当且仅当$f$和它的一阶导数同时在点$0$为零。于是$X$上的函数包含两个数据，$\mathbb{A}_K^1$上的一个函数及其一阶导数在点$0$的值。因为这个原因，有时我们将$X$叫做$\mathbb{A}_K^1$中点$0$的\textit{一阶邻域}\index{一阶!邻域}。
\end{exa}

更一般的，对于任意的$n$，理想$(x^n)$定义了一个子概形$X\subset \mathbb{A}_K^1$，它的坐标环为$K[x]/(x^n)$，$\mathbb{A}_K^1$上的函数$f(x)$在$X$上为零当且仅当$f$以及它的前$n-1$阶导数全都在点$0$处为零。

\begin{exa}[双重点]
理解双重点的下一步是考虑$\mathbb{A}_K^2=\spec K[x,y]$中支于原点的子概形，这个子概形需要同构于Example {{\addtocounter{thm}{-1}}\thethm{\addtocounter{thm}{1}}}中的那个子概形$X$. 令$Y\subset \mathbb{A}_K^2$是这样的一个子概形，$R=\mathscr{O}_Y(Y)\cong K[\varepsilon]/(\varepsilon^2)$是它的坐标环，以及满射
\[
	\varphi:K[x,y]\to R
\]
定义了$Y$到$\mathbb{A}_K^2$的含入。$R$中唯一的极大理想$\mm$在$K[x,y]$中的原像是对应于原点的理想$(x,y)$，因为在$R$中$\mm^2=0$，所以映射$\varphi$在$(x,y)^2=(x^2,xy,y^2)$上为零，进而诱导了映射
\[
	\bar\varphi:K[x,y]/(x^2,xy,y^2)\to R.
\]
等价地，$Y$必须包含在子概形
\[
	\spec K[x,y]/(x^2,xy,y^2)
\]
中。但环$K[x,y]/(x^2,xy,y^2)$是一个$K$上的三维矢量空间，$R$只有二维。这是因为，$\varphi$的核将包含一个非零齐次线性型$\alpha x+\beta y$，其中$\alpha$, $\beta\in K$. 记
\[
	X_{\alpha,\beta}=\spec K[x,y]/(x^2,xy,y^2,\alpha x+\beta y)\hookrightarrow \mathbb{A}_K^2.
\]
子概形$X_{\alpha,\beta}$能被下面的任意一个条件所刻画：

\begin{compactenum}[(i)]
\item 所有在原点为零而且在那儿偏导数满足
\[
	\beta\frac{\partial f}{\partial x}-\alpha\frac{\partial f}{\partial y}=0
\]
（因为这可以推出$f=c(\alpha x+\beta y)+\text{高阶项}$）的函数$f\in K[x,y]$构成的理想$I$的$\mathbb{A}^2_K$的相伴子概形；或者

\item Example {{\addtocounter{thm}{-1}}\thethm{\addtocounter{thm}{1}}}中的子概形$X\subset \mathbb{A}_K^1$在由$x\mapsto (\beta x,-\alpha x)$给出的含入映射$\mathbb{A}_K^1\hookrightarrow\mathbb{A}_K^2$下的像。
\end{compactenum}

经典语言下，子概形$X_{\alpha,\beta}$被称作由点$(0,0)$以及一个在$\alpha x+\beta y=0$方向上“无穷接近的点”组成，我们下面在传统图像中以一个小箭头画出$X_{\alpha,\beta}$：
\begin{center}\includegraphics[scale=\scale,bb=0 0 400 274]{\PICDIR/6.png}\end{center}
上图是想用一点连同此处切空间的一个可区分的一维子空间在平面上那个点处来表示$X_{\alpha,\beta}$（尽管箭头给了我们切矢量可区分的印象，然而实际上并没有可区分的切矢量）%\footnote{译者注：原文是``This is intended to represent a point with a distinguished one-dimensional subspace of the tangent space to the plane at that point (there is actually no distinguished tangent vector, despite the impression given by the arrow).''}
。
\end{exa}

\wrapa

在实践中，概形$X_{\alpha,\beta}$会怎么出现呢？一种方式是曲线的相交。比如，当我们想要处理一条直线$L$与一条圆锥曲线$C$相切，显然，只在集合论意义上处理它们的相交是不令人满意的：
一条直线与一条圆锥曲线应该相交两次。甚至，说$C\cap L$的交点“重数为二”也不是完全令人满意的：比如，交点应该决定直线$L$，正如在非相切的例子中那般。真正令人满意的定义是，$C\cap L$是由理想$I_C$与理想$I_L$的和决定的$\mathbb{A}_K^2$的子概形，比如使得直线$y=0$以及抛物线$y=x^2$相交于子概形$X_{0,1}=\spec K[x,y](x^2,y)$. 作为平面中唯一包含于$X_{0,1}$的直线，这将完全决定$L$. 

另一个出现形如$X_{\alpha,\beta}$的子概形的重要方式是作为可约概形的极限。比如，考虑平面上一对不同的点$(0,0)$与$(a,b)$，它们的并是闭子概形
\[
	X=\{(0,0),(a,b)\}=\spec S\subset \mathbb{A}_K^2,
\]
其中
\[
\begin{aligned}
	S&=K[x,y]/\left((x,y)\cap (x-a,y-b)\right)\\
	&=K[x,y]/(x^2-ax,xy-bx,xy-ay,y^2-by).
\end{aligned}
\]
由中国剩余定理，$S\cong K\times K$. 于是，特别地，$S$（作为矢量空间）是一个二维$K$\hyp 代数。

现在假设点$(a,b)$沿着一条曲线$(a(t),b(t))$往$(0,0)$移动，其中$(a(0),b(0))=(0,0)$而$a$, $b$是$t$的多项式，我们记作
\[
	a(t)=a_1t+a_2t^2+\cdots,\quad b(t)=b_1t+b_2t^2+\cdots.
\]

\begin{center}\includegraphics[scale=\scale,bb=0 0 399 296]{\PICDIR/8.png}\end{center}

那么$X_t=\{(0,0),(a(t),b(t))\}$在$t\to 0$的极限是什么呢？使用概形，我们能享用一种奢侈的观点，在如下的合适表述下，它的极限依然是两个点：它是一个仿射概形$X$，其坐标环还是一个$K$上的二维矢量空间。可以取下面这族理想在$t\to 0$下的极限
\[
	I_t=(x,y)\cap (x-a(t),y-b(t)).
\]
作为与$X$对应的理想来定义$X$. 当然，这仅仅把困难转移到了描述什么是理想族的极限上！但这是简单的：比如在这个例子中，我们可以把它们的极限取为$K[x,y]$
中一个（看作$K$上的矢量空间时）余维数为$2$的子空间。这个极限依然是一个理想因为乘法是连续的。一般地，在理想的余维数是无限时，一个更精巧的解释是必要的，我们将在遇到一维概形族的极限时以及\ref{s:3.3.2}节在射影情况下再一次遇到极限时讨论这个问题。

为了看看上面说的在实践中是什么意思，首先观察$I_t$的生成元$x^2-a(t)x$, $xy-b(t)x$, $xy-a(t)y$以及$y^2-b(t)y$，它们当$t\to 0$的时候有清楚的极限$x^2$, $xy$, $xy$和$y^2$，于是这些多项式应该在$I$中。此外，观察$I_t$包含线性型

\[
	a(t)y-b(t)x=(xy-b(t)x)-(xy-a(t)y),
\]
因此对$t\neq 0$，多项式
\[
	\frac{a(t)y-b(t)x}{t}=a_1y-b_1x+t(\dots)
\]
同样也在$I$中。于是，理想$I$同样也包含它的极限$a_1y-b_1x$，所以有$I\supset (x^2,xy,y^2,a_1y-b_1x)$. 但是上式右侧作为$K[x,y]$的子空间的余维数已经是$2$了。因此$I=(x^2,xy,y^2,a_1y-b_1x)$，以及，相应地，
\[
	\lim_{t\to 0}(X_t)=X_{\alpha,\beta},
\]
其中$\alpha=b_1$以及$\beta=-a_1$.

\wrapb
\indent 从这个例子我们看到，$X$作为$\mathbb{A}_K^2$的子概形，“记住”了$(a(t),b(t))$趋向$(0,0)$的方向：我们认为它包含原点以及原点处沿着直线$a_1y-b_1x=0$的切方向。这条直线是连接$(0,0)$以及$(a(t),b(t))$的直线$L_t$的极限，这就是说，这是被参数化为$(a(t),b(t))$的曲线在原点处的切线，正如右图所示。

我们将在第 \ref{s:2.3.4} 节看到如何推广极限的概念。

\subsection{多重点}

上一个例子中的子概形$X_{\alpha,\beta}$被称为平面上的“双重点”，这里\textit{双重}\index{双重!点}指坐标环
\[
	R=K[x,y]/(x^2,xy,y^2,\alpha x+\beta y)\cong K[t]/(t^2)
\]
作为$K$\hyp 模的矢量空间维数。一般地，如果$X=\spec R$是一个仿射概形，以及$R$是一个$K$上的有限维矢量空间%\footnote{译者注：即所谓的有限$K$\hyp 代数。}
，我们定义$X$相对于$K$的\idx{度}\label{deg}（degree）为$R$作为$K$\hyp 矢量空间的维度\footnote{译者注：很遗憾，前面我们在翻译`double point'的时候，将他翻译成了“双重点”，但实际上它应该是指度为2的点，而“重数”其实是一个与“度”不同的概形（见后文），所以这个翻译实际没那么恰当，但是，`double point'翻译成类似于“双点”、“二度点”又似乎没那么好听，所以我们暂时还是采用“二重点”这个译名，“三重点”、“多重点”也类似。幸运的是，当我们考虑的域是代数闭域的时候，则“重数”与“度”两个概念是等价的。}，记作$\deg_K(X)$或者再简单些$\deg(X)$. （当对域$K$不会产生歧义的时候，我们将在记号和行文中去掉脚标$K$.） 在这种情况下，我们称$\spec R$是一个\textit{有限}$K$\hyp\textit{概形}。\index{有限!概形}

下面考虑度为3及以上的例子。一些东西在这里变得不一样了。首先，代数闭域$K$上的所有双重点 ------ 即仿射概形$\spec R$，其中$R$是一个维度为2的局部$K$\hyp 代数 ------ 是同构的，因为这样的$R$必然同构于$K[x]/(x^2)$. （证明：令$\mm$是$R$的极大理想，因为$K$没有有限维扩张，于是$R/\mm\cong K$. 因为$R$是二维的，$\mm$是一维的，所以$\mm^2=0$（比如，从Nakayama引理可以得到这点
\footnote{译者注：因为$\mm^2$作为$\mm$的子模，要么是一维的要么是$0$，如果是一维的，则$\mm=\mm^2$，此时由Nakayama引理，存在一个$a\in \mm$使得$am=m$对所有的$m\in \mm$都成立。注意到$\mm$是唯一的极大理想，所以$1-a$可逆，故$m=0$，这与$\mm$是一维的矛盾。}
）。于是从$K[x]$到$R$的自然满射的核包含$x^2$，这样$R$与$K[x]/(x^2)$的同构就已经给出了。）作为对比，对于三重点（度为3的点）这并不正确：很容易就可以看出概形
\[
	\spec K[x]/(x^3)\quad\text{和}\quad \spec K[x,y]/(x^2,xy,y^2)
\]
是不同构的。然而，任意三重点同构于上面两者中的一个，这个事实的证明我们留作下面的习题。

\begin{exe}
	设$K$是一个代数闭域，令$Z=\spec K[x_1,$ $\dots$, $x_n]/I\subset \mathbb{A}_K^n$是任意的度为3的支于原点的零维子概形。证明，$Z$同构于$X=\spec K[x]/(x^3)$或者
	\[
		Y=\spec K[x,y]/(x^2,xy,y^2),
	\]
	以及$X$与$Y$并不同构。
\end{exe}

特别地，任意的$K$\hyp 矢量空间维度为3的环$K[x_1,$ $\dots$, $x_n]/I$能被两个$x_i$的线性型生成。几何上来看，这就是说，$\mathbb{A}_K^n$中度为3的点是平面的，即，处于一个线性子空间$\mathbb{A}_K^2\subset \mathbb{A}_K^n$上。在$\mathbb{A}_K^2$中，以上两类三重点能被实现为三族不同的点的极限。同构于$X$的那一类，能被看作三个点都来自于同一条非奇异曲线，而同构于$Y$的那一类来自于当两个点以两个不同的方向趋向于第三个点。下面的练习包含了这些现象的例子。

\begin{exe}
	\begin{compactenum}[(i)]
		\item 证明，$\mathbb{A}_K^2$的由理想$(y-x^2,xy)$给出的子概形来自于在圆锥曲线$y=x^2$三个点的极限，这个子概形同构于上面的$X$，但并不包含于$\mathbb{A}_K^2$的任意直线中。

		\begin{center}\includegraphics[scale=\scale,bb=0 0 564 255]{\PICDIR/10.png}\end{center}

		\item 证明，同构于上面的$Y$的$\mathbb{A}_K^2$的子概形，来自于当两个点以不同方向趋向于第三个点的极限。
	\end{compactenum}
\end{exe}

\begin{exe} （对那些熟悉Grassmannian的人。）上面的例子可能让人觉得同构于$X$的概形是那些同构于$Y$的概形的极限\footnote{译者注：大概是上面第二幅图的夹角逐渐减小吧。}。然而事实并不如人所愿，下面的例子刚好与其相反。令$\mathscr{H}$是一族$\mathbb{A}_K^2$中支于原点的度为$3$的有限子概形，$\mathscr{H}$可以通过六维矢量空间$K[x,y]/(x,y)^3$ 余维数为$3$的子空间们的Grassmannian的一个闭子概形自然地参数化。证明$\mathscr{H}$是一个曲面，其中一点对应于唯一的子概形$\spec K[x,y]/(x^2,xy,y^2)$，它同构于$Y$，其余的点对应于同构于$X$的子概形。证明，概形$\mathscr{H}$同构于$\mathbb{P}^3_K$中的一个二维立体圆锥，其顶点对应于$Y$.
\end{exe}

\begin{exe}
	令$C$是$\mathbb{A}_K^n$中由理想
	\[
	J=(\text{$x_2-x_1^2$, $x_3-x_1^3$, $\dots$})
	\]
	给出的子概形。$C$中的一个闭点具有形式$f(t)=(t$, $t^2$, $t^3$, $\dots$, $t^n)$，其中$t\in K$，它有理想$(x_1-t$, $x_2-t^2$, $\dots)$. 考虑对$t\neq 0$的三点子概形
	\[
	X_t=\{\text{$f(0)$, $f(t)$, $f(2t)$}\}\subset C.
	\]

	\begin{compactenum}[(a)]
		\item 证明，当$t\to 0$时候概形$X_t$的极限是
		\[
		X_0=\spec K[\text{$x_1$, $\dots$, $x_n$}]/(\text{$x_2-x_1^2$, $x_1x_2$, $x_3$, $x_4$, $\dots$, $x_n$}),
		\]
		它同构于上面提到的三重点$\spec K[x]/(x^3)$.
		\item 证明，然而，$X_0$并不包含于$C$在原点的切线中。而是，包含$X_0$的$\mathbb{A}_K^n$的最小线性子空间是$C$的密切2-平面
		\[
		x_3=x_4=\cdots=x_n=0,
		\]
		（回忆，按定义，这是切线与$C$上在原点附近的另一点一起张成的平面在这个点趋向原点时的极限），然而$C$的切线是$\mathbb{A}_K^n$包含由$X_0$坐标环的极大理想的平方定义的子概形的最小线性子空间。于是，在这层意味上，$X_0$同时“记住”了$C$的切线与密切2-平面。
	\end{compactenum}
\end{exe}

\begin{exe}
	考虑对$t\neq 0$，子概形
	\[
	X_t=\{\text{$(0,0)$, $(t,0)$, $(0,t)$}\}\subset \mathbb{A}_K^2
	\]
	每个都包含了$\mathbb{A}_{K}^2$中三个不同的点。

	\begin{compactenum}[(a)]
		\item 证明，这族概形当$t\to 0$时的极限为
		\[
		X_0=\spec K[x,y]/(x^2,xy,y^2).
		\]
		\item 证明，$\mathbb{A}_K^2$上的函数$f\in K[x,y]$限制在$X_0$上决定了也被决定于它在原点的值以及在原点处任意方向的一阶导数值。于是我们可以认为$X_0$是$(0,0)$的一阶无穷小邻域。
		\item 证明，$X_0$包含于任意两条穿过$(0,0)$的不同直线的并中。
		\item 证明，$X_0$不包含于任意的非奇异曲线中，因此特别地，$X_0$不是$\mathbb{A}_K^2$中任意两条非奇异曲线概形意义上的交。
	\end{compactenum}
\end{exe}

如前所述，两类三重点都可以嵌入到任意仿射空间中的平面中。但是度为4的点$\spec K[x$, $y$, $z]/(x,y,z)^2$不能，因为它的极大理想不能被两个元素所生成。其他的新现象将在立体多重点（即不能包含于平面中）以及更高维度空间中的多重点上出现。比如，在四维仿射空间中不是每个度为$21$的点都可以写成$21$个不同的点的极限，见下一个习题。（同样可见Iarrobino [1985].）

\begin{exe}
	考虑$\mathbb{A}_K^4$的零维子概形$\Gamma$，其度为$21$，使得
	\[
	V(\mm^3)\subset \Gamma \subset V(\mm^4),
	\]
	其中$\mm$是$\mathbb{A}_K^4$中原点的极大理想。证明存在一个这样的子概形的$84$维族，然后推出一个一般的这样的子概形不是一个约态概形的极限。
\end{exe}

\begin{exe}
	将$\mathbb{A}_K^2$的度为4和5的且支于原点的零维子概形分类到同构，其中哪些同构于$\spec K$上的概形？
\end{exe}

\begin{exe}
	对一个支于一点的概形，如果（局部）环的极大理想被一个元素生成，或者等价地，它的Zariski切空间的维度为0或者1，则称其为\textit{曲线的}。（这个名字来自于如下事实：正是这些概形能被包含于一条非奇异曲线中。）证明，对任意两个度为2且支于一点的$\mathbb{A}_K^2$的子概形，可以通过一个平面上的线性变换从一个变成另一个，但是对长\footnote{译者注：长指`length'，它的定义见后面。}为3的曲线概形就不对了。（但注意，任意两个度相同的$\mathbb{A}_K^2$的曲线子概形\textit{可以}通过一个$\mathbb{A}_K^2$的自同构从一个变到另一个。）
\end{exe}

\begin{exe}
	（对那些熟悉曲线的人。）对支于原点的仿射$3$\hyp 空间的度为7的子概形，存在无限多的同构型。对支于原点的仿射平面的度为8的子概形，存在无限多的同构型。
\end{exe}

可以料到，非代数闭域上非约态概形的行为将变得更加复杂。下面的习题给出了一个例子。

\begin{exe}
	分类所有度为2和3的$\rr$上支于$\mathbb{A}_\rr^2$原点的概形。$\rr$上的概形$X$的复化指$\cc$上的概形$X\times_{\spec \rr}\spec \cc$. 特别地，证明虽然$\rr$上每个复化后同构于$\spec \cc[x]/(x^3)$的概形都同构于$\spec \rr[x]/(x^3)$，但存在且只存在两个不同构的概形$X$，它们的复化都同构于$\spec \cc[x,y]/(x^2,xy,y^2)$.
\end{exe}

\paragraph*{度与重数}\addcontentsline{toc}{subsubsection}{度与重数}
回忆在第 \pageref{deg} 页，我们定义了一个有限仿射$K$\hyp 概形$X=\spec R$的\textit{度}，它是$R$作为有限维$K$\hyp 矢量空间的维度。当$K$是代数闭的时候，这样一个概形$X$的度，从某种角度来说，度量了它的非约态的程度。然而，就像最后一个习题所展现的，在一般的情况下这并不正确：$\spec \cc$是约态的，但是作为$R$上的概形，它的度为2.

这里有另一个概念，称为重数（multiplicity），它度量了$X$非约态的程度。与度依赖于基域$K\subset R$选取不同，重数是$X$本身的不变量，它在更一般的情况下有定义 ------ 我们这里将在任意Krull维数为零的局部环$R$（即任意Artin局部环）上定义它。

令$R$是任意的零维局部环，它的极大理想是$\mm$. 可以选取$R$的一列理想
\[
	R\supset \mm = I_1\supset I_2\supset \cdots \supset I_{l-1}\supset I_l=0
\]
使得每一个商$I_j/I_{j+1}$作为$R$\hyp 模同构于$R/\mm$. （比如，我们能从一个比较粗的列
\[
	R\supset \mm \supset \mm^2\supset \cdots \supset 0
\]
开始，然后不断选取任意$R/\mm$\hyp 矢量空间$\mm^j/\mm^{j+1}$的子空间来加细它。）虽然这样一条列的选取不唯一，但是它的长度$l$确实与选取无关的，我们定义$l$为环$R$或者零维概形$X$的\textit{重数}或者\textit{长度}\index{长度!环的}\index{长度!概形的}（比如见Eisenbud [1995, Section 2.4]）。注意在原来的情况，当$R$是一个$K$上的有限维矢量空间时，剩余类域$R/\mm=\kappa$是$K$的一个有限扩张，所以我们有关系
\[
	\deg_K(X)=[\kappa:K]~\mathrm{mult}(X).
\]

对于任意的零维概形$X$，以及点$p\in X$，我们定义$X$在点$p$处的\textit{重数}为局部环$\mathscr{O}_{X,p}$的重数，记作$\mathrm{mult}_p(X)$. 如果$X$是一个有限$K$\hyp 概形，则$X$相对于$K$的度由
\[
	\deg_K(X)=\sum_{p\in X}[\kappa(p):K]~\mathrm{mult}_p(X)
\]
给出。

在第 \ref{chap:3} 章，我们将看到度和重数的概念如何拓展到正维数的概形上面去。

\subsection{嵌入点}

我们现在考虑一些高维非约态概形的例子，为简单起见，下面出现的约态概形都考虑为一条直线。尽管如此，大量可能的行为出现了。比如存在概形除了一点外看起来都像约态概形，或者存在概形处处都是非约态。在这一小节中，我们考虑前者。术语上，我们称概形$X=\spec K[x_1$, $\dots$, $x_n]/I\subset \bba_{K}^n$有一个\textit{嵌入组分}，如果某个开集$U\subset \mathbb{A}^n_K$交$X$于一个$X$的稠密子集，且$X\cap U$（定义于第 \ref{s:1.2.1} 小节）的闭包并不等于$X$；或者，等价地，理想$I$的准素分解包含嵌入素理想们（见下面对准素分解的讨论）。如果嵌入素理想是极大的 ------ 等价地，如果$U$可以取为一个点的补 ------ 我们谈论的是\textit{嵌入点}。因为下面讨论的概形$X$都是一维的，我们下面也只会见到嵌入点。

在一点外都是约态的非约态概形最简单的例子是$X=\spec K[x,y]/(y^2,xy)\subset \bba_K^2$. 理想$I=(y^2,xy)\subset K[x,y]$是在直线$y=0$为零以及在点$(0,0)$有二阶零点的平面上的函数构成的理想。代数上来讲，这就意味着$(y^2,xy)=(y)\cap (x,y)^2$. 于是，我们可以将概形$X$看作直线$y=0$稍作变形得到的，即，$X$上的函数$f$被其在$y=0$上的限制$f(x,0)$与其在$(0,0)$处沿着直线的导数$\partial f/\partial y(0,0)$所定义。

将$X$具象为一条由$y=0$定义的直线与一个非约化点的并是比较方便的，比如，由理想$(x^2,xy,y^2)$定义的“原点的一阶邻域”。

\begin{center}\includegraphics[scale=\scale,bb=0 0 410 59]{\PICDIR/11.png}\end{center}

这样的\textit{准素分解}对任意概形是存在的：我们这里简单地回顾一下代数基础知识。更多的细节，比如可见，Eisenbud [1995]; Atiyah \& Macdonald [1969]或者是这些参考文献中可能最平易近人的，Northcott [1953].

\paragraph*{准素分解} \addcontentsline{toc}{subsubsection}{准素分解}
给定Noether环$R$中的一个理想$I$，我们定义$I$的\textit{相伴素理想}是那些素理想$\pp$使得$\pp$是$R/I$中某个元素的零化子。这个素理想构成了一个有限集。

一个理想$\mathfrak{q}\subset \pp$被称为\textit{准素}\index{准素!理想}于$\pp$，或者称作
$\pp$-准素的，如果$\pp$是$\mathfrak{q}$的\textit{根}\index{根}（那些存在一个幂在$\mathfrak{q}$中的元素构成的集合），任取$f$, $g\in R$满足$fg\in \mathfrak{q}$但$f\not\in \pp$，则我们有$g\in\mathfrak{q}$；等价地，$\mathfrak{q}$是$\pp$-准素的，如果$\pp$是它的根以及局部化映射$R/\mathfrak{q}\to R_{\pp}/\mathfrak{q}R_\pp$是一个单射。

任意理想$I$能被表为一族准素理想的交。因为准素于某素理想的理想们相交依然准素于这个素理想，$I$甚至能被表为准素于不同素理想的理想的交。如果我们有了这样一个分解，使得每一个准素理想都准素于不同素理想，且在该分解中不能再去掉任意的准素理想，此时这样的分解就被称为$I$的一个\textit{准素分解}\index{准素!分解}，此分解中的准素理想就被称为\textit{准素组分}\index{准素!组分}。

$I$的相伴素理想正是那些准素组分的根。给定一个$I$的相伴素理想$\pp$，$I$的$\pp$-准素组分不由$I$唯一决定，然而当$\pp$在$I$的相伴素理想中是极小素理想时，$I$的$\pp$-准素组分由$I$唯一决定。这样的准素组分被称为\textit{孤立组分}。

\begin{exe}
	取$I=(y^2,xy)$，分解
	\[
	I=(y)\cap (x,y)^2
	\]
	已经将$I$分解为两个准素理想的交（第一个是素理想，第二个准素于$(x,y)$）。
\end{exe}

因为$(y)$或者$(x,y)^2$都不能从上述分解中略去，这是一个准素分解，它们对应的$X$的相伴概形（相伴概形在下面定义）就是直线$X_{\mathrm{red}}$以及在原点处的约态点。在准素分解中，$(x,y)$\hyp 准素组分不是唯一的，它可以取作$(x,y^2)$或者$(x+y,y^2)$，或者实际上下面无数理想中的任意一个，以及它们的交$(x^2,xy,y^2)$，或者是任意的理想$(x^n,xy,y^2)$，其中$n\geq 2$. 当然，$(y)$\hyp 准素组分$(y)$是唯一的，因为$X_{\mathrm{red}}$并不包含于其他任意的相伴概形中。

虽然有这种不唯一性，但对一个给定的相伴素理想$\pp$，$\pp$-准素组分却有一个良定的\textit{长度}概念，不需要选定准素分解，它等于环$R_\pp/IR_\pp$中最长的有限长理想的长度。这里一个模$M$的长度是指子模链
\[
	M\supsetneqq M_1 \supsetneqq M_2 \supsetneqq \cdots \supsetneqq M_{l-1} \supsetneqq M_l=0
\]
的最长长度。

\begin{exe}
	$(xy,y^2)$在原点处的准素组分的长度是$1$.
\end{exe}

不难将这些东西翻译成概形的几何：对任意的Noether环$R$，仿射概形$X=\spec R$是“准素”闭子概形的并，它们被称做\textit{准素组分}\index{准素!组分}。其中，一个\textit{准素仿射概形}\index{准素!仿射概形}是一个仿射概形$Y$，满足$Y_{\text{red}}$不可约，以及对$Y$上的函数$f$, $g$，
\[
	\left. 
		\begin{aligned}
			&\text{$fg$在$Y$上为零，但}\\
			&\text{$f$在$Y_{\text{red}}$上不为零}
		\end{aligned}
	\right\} \Rightarrow \text{$g$在$Y$上为零。}
\]
在这样一个$X$的\textit{准素分解}\index{准素!分解}
\footnote{译者注：作者在处理理想的时候，准素分解是指极小的那些，但是在处理概形的时候，准素分解是任意的分解。有这样一点差异，因此下面会提到极小准素分解。在这里，准素闭子概形$Y$类比$\pp$-准素组分$\mathfrak{q}$的话，而$Y_{\text{red}}$就类比$\pp$.}
中，在集合意义上极大的组分是唯一的，它们被称为\textit{孤立组分}，而其他的组分被称为\textit{嵌入组分}，因为它们的支集包含于更大的组分中。嵌入组分并不唯一。然而，准素分解至少存在两个良好的唯一性：
\begin{compactenum}[(1)]
\item 在极小准素分解中，对应于准素组分$Y$的约态概形$Y_{\text{red}}$的集合是唯一的（与所选取的准素分解无关），它被称为仿射概形$X$的\textit{相伴概形}的集合。
\item 设$Y$是$X$的一个相伴概形，约态概形为$Y$的准素组分的“长度”是唯一的，这个长度称作$X$的\textit{相伴概形$Y$的重数}。
\end{compactenum}

我们将用$X=\spec K[x,y]/(y^2,xy)$的例子来演示上面的概念：首先观察到$X$是直线
\[
	X_{\text{red}}=\spec K[x,y]/(y)
\]
以及一个多重点
\[
	Y:=\spec K[x,y]/(x^2,xy,y^2)
\]
的并，我们已经看到这给出了一个准素分解，原点处的嵌入子概形的重数是$1$.

正如我们已观察到的，我们能以许多不同方式将$X$写成一条线与一个点的并：比如，对任意的$\alpha\neq 0$，我们有$X=Y\cup Z$，其中$Z=X_{\text{red}}=\spec K[x,y]/(y)$是一条直线，而$Y$，以\ref{s:2.3.1}节中的语言，是子概形$X_{1,\alpha}$:
\[
	Y=\spec K[x,y]/(x^2,xy,y^2,x+\alpha y).
\]
选两个这样的子概形$Y$, $Y'$给出一个满足
\[
	Y\cup Z=Y'\cup Z\quad \text{和}\quad Y\cap Z=Y'\cap Z,\quad \text{但}\,\,Y\neq Y'
\]\label{p:69}
的$\bba_K^2$中子概形$Y$, $Y'$和$Z$的例子。

在上面的例子中，$X$能被描述为$\bba_K^2$中唯一包含（约态）$x$-轴加上原点处一个重数为$1$的嵌入点的子概形。但是，嵌入点同样也能携带不少几何信息。

\begin{exe}
	选一个$\bba_K^2$到$\bba^3_K$的线性嵌入，令$P$是$\bba_K^2$的像，以及令$X'$是$X$的像。证明，$P$作为$\bba_K^2$中包含$X'$的平面，他将由$X'$唯一确定。
\end{exe}

考虑如下的$\bba_K^2$和$\bba_K^3$中的子概形是同样富有趣味的：它们的支集是两条给定的直线，并且，在两条直线的交点处有一个重数为$1$的嵌入点。在平面上，如果我们取两条直线为坐标轴，这样的概形可以取作
\[
	X=\spec K[x,y]/(x^2y,xy^2).
\]
几何上，他能被看作两条由$xy=0$定义的直线以及点$\spec K[x,y]/(x^3,x^2y,xy^2,y^3)$的并。 在$3$\hyp 空间中，如果我们取直线为$(x=z=0)$以及$(y=z=0)$，我们能得到的子概形或者是
\[
	Y_1=\spec K[x,y,z]/(z,x^2y,xy^2)
\]
或者是
\[
	Y_2=\spec K[x,y,z]/(z^2,xz,yz,xy).
\]
$Y_1$是上面的概形$X$在$\bba_K^2$作为$\bba_K^3$中的$z=0$平面的嵌入下的像，而$Y_2$是两条直线以及$\bba_K^3$中由原点的极大理想的平方定义的子概形的并。

\begin{exe}
	证明$Y_1\not\cong Y_2$.
	\begin{compactenum}[(a)]
		\item 证明，$Y_1\cong X$是在同构意义上，平面上支集是两条相交直线且在交点处有一个重数为$1$的嵌入点的唯一例子。
		\item 证明，在$3$\hyp 空间中，$Y_2$在同构意义上是，支集是两条不共面相交直线，且在交点处有一个重数为$1$的嵌入点的唯一例子。
	\end{compactenum}
\end{exe}

认为概形$X=\spec K[x,y]/(xy,y^2)$在原点处有一个重数为$1$的嵌入点的一个根据是，$X$是子概形族
\[
	X_{\text{red}}\cup Y_t
\]
在$t\to 0$下的极限，其中$Y_t$是包含一个约态点
\[
	\spec K[x,y]/(x,y-t)\subset \bba_K^2
\]
的概形。

这看上去是有道理的，因为$X_{\text{red}}\cup Y_t$的理想
\[
	(x,y-t)\cap (y)=(xy,y^2-ty)
\]
在$t\to 0$时候看上去自然趋向于$(xy,y^2)$. 然而，我们前面引入的极限概念还不够强到能处理这个例子，因为$X_{\text{red}}\cup Y_t$的理想$(x,y-t)\cap(y)$余维数不是有限的。在下一小节我们将修正这一点，在更一般的上下文中描述如何取概形族的极限。

\subsection{概形的平坦族}\label{s:2.3.4}

概形族是一个相当一般的概形，我们仅将一族概形定义为一个概形间的态射$\pi:X\to B$！族中的概形是$\pi$在$B$上点的纤维。这个概念包含了其他我们能想到的概念，比如一个“含参方程”定义的概形，$B$这是是参数变动的空间。

然而，概形族仅定义为一个任意态射$\pi:X\to B$实在太过一般以至于几乎没啥用，因为这个概形族的纤维可能完全不同。比如，给出一族概形$\pi:X\to B$与一个$B$的闭点$b$，将$X$替换为$X-\pi^{-1}b$与一些其他概形$Y$的不交并，然后将所有$Y$都映射到$b$，我们就构造了一个新的概形族，此时$b$的纤维就变成了$Y$. 因此，如果想要概形族在某种合理的意义上连续地变化，我们必须加上其他条件。这里的“合理”意指什么并不是显然的。至少要求它包含所有的连续变化族的母亲是自然的，即给定度的射影平面曲线（见3.2.8节）。其他例子是由多项式环中有着常有限余维数的理想族定义的概形族，就像我们在多重点的极限那里考虑的那样。

在许多几何理论中，我们能通过要求该族局部平凡得到一个连续变化族的正确概念，即，在某种合适的意义上，这族局部看来像是一个直积往一个因子的投影\footnote{译者注：比如纤维丛。}。但这对我们来说有两点错误。首先，如果我们天真地尝试对概形做同样的事情，将局部理解为Zariski拓扑中的局部，我们将得到了一个限制太多而无用的概念。一个更世故的方法是将局部平凡性要求成解析的，就是说，对$x\in X$以及$b=\pi(x)$，要求局部环$\oo_{X,x}$的完备化看起来像一个局部环$\oo_{B,b}$的完备化上的幂级数环。这个概念非常有用（被称为\textit{光滑}），但是它排除了诸如一族给定度的平面曲线的情况，因为光滑族不能有奇异纤维。光滑性同样排除了上一节中处理的族，不同点的不交并趋向于一个多重点，在多重点处，上述判据不能被满足。因此，我们必须寻找一个更一般的概念。

这种一般概念的最佳候选人是\textit{平坦性}。为了了解这个定义的动机，我们首先考虑更直观的极限概念。

\paragraph*{极限}\addcontentsline{toc}{subsubsection}{极限}
理解平坦性的几何内涵的起点是概形的单参数族的极限概念。

我们从比较具体的东西开始：$B$上的\textit{给定概形}$A$\textit{的闭子概形族}是一个$B\times A$的闭子概形$X\subset B\times A$和限制在$X$上的投射映射$B\times A\to B$，于是$X$在点$b\in B$上的纤维自然是$B\times A$在$B$上的纤维$A_b$的闭子概形。

令$B$是一个非奇异一维概形，典型地，我们对$R=K[t]$, $K[t]_{(t)}$或者$K[\![t]\!]$考虑$\spec R$，尽管任意的Dedekind整环（比如$\zz$或者$\zz_{(p)}$）也行。令$0\in B$是任意的闭点，即$B^*=B\setminus \{0\}$是$B$关于$\{0\}$的补。令$\mathbb{A}_B^n$和$\bba_{B^*}^n$是一般意义上，$B$与$B^*$上的仿射$n$-空间。

考虑一个$\bba_{B^*}^n=\bba_\zz^n\times B^*$的闭子概形$\mathscr{X}^*$，我们可以将其看作一个由$B^*$参数化的闭仿射概形族，即，对每一个$b\in B^*$，令$X_b=\pi^{-1}(b)$是投影$\pi:\mathscr{X}^*\to \bba_{B^*}^n\to B^*$的纤维，以及将这些概形$X_b$看作一个族。（在$B=\spec R$，其中$R=K[t]$或者$K[t]_{(t)}$的情况中，我们能将$\mathscr{X}^*$看作“$\mathbb{A}_K^n$中随着参数$t$改变的子概形族”。）我们问这样一个基本的问题：概形$X_b$在$b$趋向于$0$时候的极限是什么？

\begin{center}\includegraphics[scale=\scale,bb=0 0 479 335]{\PICDIR/12.png}\end{center}

答案，也是唯一可能的答案，足够简单：因为概形族$X_b$的极限在任何合理的意义下都必须纳入一个包含所有概形$X_b$的族中，我们取$\mathscr{X}\subset \mathbb{A}_B^n$为$\mathscr{X}^*$在$\bba_B^n$中的闭包$\overline{\mathscr{X}^*}$，以及取概形族的极限$\lim_{b\to 0}X_b$为$\mathscr{X}$在点$0\in B$处的纤维$X_0$.

更具体些，若$B=\spec R$是仿射概形，以及$t\in R$是对应于点$0\in B$的极大理想$\mm\subset R$的一个生成元（于是$B^*=\spec R[t^{-1}]$），以及$I(\mathscr{X}^*)\subset R[t^{-1}][x_1$, $\dots$, $x_n])$是$\mathscr{X}^*\subset \bba_{B^*}^n$的理想，于是子概形$\mathscr{X}\subset \bba_{B}^n$的理想是交
\[
	I(\mathscr{X})=I(\mathscr{X}^*)\cap R[x_1,\,\dots,\,x_n].
\]
为了再具体些，若取$B=\spec K[t]$，极限概形$X_0\subset \bba_K^n$在概形$X_t$上为零的多项式的极限上为零\footnote{译者注：原文是``the limiting scheme $X_0\subset \bba_K^n$ is cut out by the limits of polynomials vanishing on the schemes $X_t$''.} ，换句话说，如果我们将理想$I(X_t)\subset K[x_1$, $\dots$, $x_n]$看作$K$\hyp 矢量空间$K[x_1$, $\dots$, $x_n]$的线性子空间，以及令$V\subset K[x_1$, $\dots$, $x_n]$是平面族$I(X_t)$的极限位置 ，则理想$I(X_0)$被$V$所生成。于是，这个极限的定义扩展了第\ref{s:2.3.1}节中用过的朴素极限概念。

举个例子，取$B=\spec K[t]$以及$B^*=B\setminus \{0\}=\spec K[t,t^{-1}]$，以及令$\bba_K^1$的子概形$X_t$包含两个点，坐标分别为$t$和$-t$，即，取$\mathscr{X}^*=V(x^2-t^2)\subset \spec K[t,t^{-1}][x]=\bba_{B^*}^1$. 于是，在$\bba_B^n$中，$\mathscr{X}^*$的闭包$\mathscr{X}$同样被$X=V(x^2-t^2)\subset \spec K[t][x]=\mathbb{A}_B^1$给出，以及$\mathscr{X}$在点$0\in B$的纤维$X_0$就是双重点$X_0=V(x^2)\subset\bba_K^1$.

概形族$\mathscr{X}^*\subset \bba_{B^*}^n$的极限概念非常依赖于到$\bba_{B^*}^n$的嵌入，而不只依赖抽象族$\mathscr{X}^*\to B^*$. 于是，在上面的例子中，概形族$\mathscr{Y}^*=V(x^2-1)$以及概形族$\mathscr{Z}^*=V(x^2-t^{-2})\subset \spec K[t,t^{-1}][x]=\bba_{B^*}^1$作为$B^*$\hyp 概形是同构的，但是$\mathscr{Y}^*$的极限是两个约态点$V(x^2-1)\subset \bba^1_K$而$\mathscr{Z}^*$的极限是空集。

\paragraph*{例子}\addcontentsline{toc}{subsubsection}{例子}
现在我们遇到的极限的例子都是零维度概形的极限。这里有一些涉及正维的例子。 它们也是有启发性的，因为它们说明了嵌入点如何在簇的极限中自然地出现。

第一个例子是$\mathbb{A}_K^3$中的三条穿过原点的直线，其中$K$是一个域。我们取三条坐标轴，转动其中一个到另两条直线的平面中，然后问这个族的极限是什么。明确地，在$\bba_K^3=\spec K[x,y,z]$中，我们令$L=V(y,z)$是$x$-轴，$M=V(x,z)$是$y$-轴以及$N_t$是直线
\[
	N_t=V(x-y,z-tx).
\]
对$t\neq 0$，我们令$X_t=L\cup M\cup N_t$. 曲线$\{X_t\}_{t\neq 0}$构成了基底$B^*=\spec K[t,t^{-1}]$上的一个族$\mathscr{X}^*\subset \bba_{B^*}^3$，我们即是在寻找这个族的极限$X_0$.

这是直接的计算，尽管答案可能会让人在开始的时候惊讶一下。三个坐标轴的并的概形是$(xy$, $xz$, $yz)$，于是，对$t\neq 0$，概形$X_t$的理想是由线性型的乘积生成的：
\[
	I(X_t)=(Q_1,Q_2,Q_3),
\]
其中
\[
	\begin{aligned}
		Q_1&=z(z-tx)\\
		Q_2&=z(z-ty)\\
		Q_3&=(z-tx)(z-ty).
	\end{aligned}
\]
当我们令$t$趋向于$0$，我们看到极限概形的理想包含$z^2$，这是$Q_1$, $Q_2$和$Q_3$共同的极限。此外，对于$t\neq 0$，理想$I(X_t)$包含$Q_1-Q_3=tyz-t^2xy$以及$Q_2-Q_3=txz-t^2xy$. 于是对$t\neq 0$，理想包含
\[
	\frac{Q_1-Q_3}{t}=yz-txy\quad\text{以及}\quad \frac{Q_2-Q_3}{t}=xz-txy.
\]
最后，$X_t$的理想包含
\[
	x\frac{Q_1-Q_3}{t}-y\frac{Q_2-Q_3}{t}=txy(x-t),
\]
因此极限概形的理想包含$xy(x-y)$. 综上，我们有
\[
	I(X_0)\supset (xz,yz,z^2,xy(x-t)),
\]
可以断言，实际上这还是一个等式。我们一会儿将验证这点，但在这之前，我们需要指出该极限的一个异乎寻常之处：\textit{概形族}$\{X_t=L\cup M\cup N_t\}_{t\neq 0}$\textit{的极限概形}$X_0$\textit{并不只是并}$L\cup M\cup N_0$. 事实上，并的理想是
\[
	I(L\cup M\cup N_0)=(z,xy(x-y)),
\]
于是
\[
	I(X_0)=I(L\cup M\cup N_0)\cap (x,y,z)^2.
\]
换句话说，极限概形$X_0$在原点处有一个嵌入点。

事实上，这点并不难直接看出，同时反过来也助我们证明等式$I(X_0)=(xz,yz,z^2,xy(x-y))$：所有的概形$X_t$都在原点$(0,0,0)\in\bba_K^3$处有一个三维Zariski切空间，试$X_0$必须也有一个，因为如果$\mathscr{X}\subset \bba_B^n$是任意的闭子概形以及$\sigma:B\to\mathscr{X}$是$\mathscr{X}\to B$的任意截面，Zariski切空间$T_{\sigma(b)}\mathscr{X}$的维数是$b\in B$的一个上半连续函数。这就转而给出了
\[
	I(X_0)\subset I(L\cup M\cup N_0)\cap (x,y,z)^2=(xz,yz,z^2,xy(x-t)),
\]
继而等式成立。

一个类似的例子是，$\mathbb{A}_K^3$中包含两条不交直线的概形在直线移动到相交于一点时的极限。就像下一个习题所证明的，它们的极限在交点处也有一个嵌入点。

\begin{exe}
令$L_t$是$\bba_K^3$中由理想$(y,z-t)$定义的直线，而$M$是由$(x,z)$定义的直线。对$t\neq 0$，令$X_t$是它们的并。证明，$X_t$的极限是概形
\[
	X_0=\spec K[x,y,z]/(z^2,xz,yz,xy).
\]

\begin{center}\includegraphics[scale=\scale,bb=0 0 643 222]{\PICDIR/13.png}\end{center}
\end{exe}

下面的习题说明了，嵌入点在极限中出现绝不是偶然：

\begin{exe}
\begin{compactenum}[(a)]
\item 证明，不存在由$B^*=\spec K[t,t^{-1}]$参数化的与$M=V(x,z)$不交的直线族$L_t\subset \bba_K^3$，使得$M\cup L_t$在$t\to 0$时的极限是约态概形
\[
	X=\spec K[x,y,z]/(z,xy).
\]

\item 类似地，证明，不存在由$B^*=\spec K[t,t^{-1}]$参数化的直线族$L_t\subset \bba_K^3$使得$M\cup L_t$在$t\to 0$时的极限是概形
\[
	X=\spec K[x,y,z]/(z,x^2y,xy^2).
\]
\end{compactenum}

注意，在上面的两个和在前面分析过的例子中，概形的并的极限真包含了它们极限的并。我们将在第\ref{chap:5}章回到这点上。
\end{exe}

取给定概形的单参子概形族的极限是代数几何中的一个基本的操作。在本书的后面出现的例子中，我们将通过ad-hoc\nottran 法来计算这样极限的理想，正如下面演示的那样。但是，这里有一个一般的算法来算这东西，当然最好由机器来算。比如，假设有基$B=\spec K[t]$以及一个理想$\mathscr{I}\subset K[t][x_1$, $\dots$, $x_n]$，同时对$\lambda \neq 0$，还有由理想
\[
	I_\lambda=(\mathscr{I},t-\lambda)/(t-\lambda)\subset K[t][\text{$x_1$, $\dots$, $x_n$}]/(t-\lambda)\cong K[\text{$x_1$, $\dots$, $x_n$}].
\]
定义的概形$X_\lambda\subset \bba_K^n$. 接着我们定义理想$\mathscr{J}\subset K[t][x_1$, $\dots$, $x_n]$为
\[
	\mathscr{J}=\bigcup_k (\mathscr{I}:t^k);
\]
即，$\mathscr{J}$是那些存在某个$k$使得$t^k f$成立的多项式$f(t$, $x_1$, $\dots$, $x_n)$构成的理想。这些可以由Gr\"{o}bner基来计算，见Eisenbud [1995, Chapter \uppercase\expandafter{\romannumeral15}].

\paragraph*{平坦性}\addcontentsline{toc}{subsubsection}{平坦性}
前面的讨论已经足够描述给定概形$A$（比如仿射或者射影空间）的，在非奇异一维基底上连续变化的子概形族的极限：称一个族$X\subset B\times A$是连续的，如果它的每一个纤维是附近那些纤维的极限。然而，这个概念依然太过限制了：比如他还不足以描述基$B$是非约态的这样一个已被证明是非常有用的情况。为了将概念扩展到最普遍的环境，Serre引入了以下概念：

\begin{defi}
	设$R$是一个环而模$M$是$R$\hyp 模，如果对任意的$R$\hyp 模单同态$A\to B$，诱导的映射$M\otimes_R A\to M\otimes_R B$依然是单同态的，则称$M$是平坦的。
\end{defi}

特别地，任意的自由模都是平坦的，于是，如果$R$是一个域，则每一个模都是平坦的。如果$R$是一个Dedekind整环，不难证明，$M$是平坦的当且仅当$M$是无挠的。我们下面建立与之对应的几何定义：

\begin{defi}
	一族概形间的态射$\pi:X\to B$是平坦的，如果对每一个$x\in X$，局部环$\mathscr{O}_{X,x}$通过映射$\pi^\#$作为$\mathscr{O}_{B,\pi(x)}$\hyp 模时是平坦的。
\end{defi}

这个概念已足够一般到包含给定度的平面曲线族，但也足够限制，使得平坦族中簇有很多共同点。这已足够令人满意，除了（第一眼看上去）它似乎不是一个非常“几何”的性质。 然而，这实际上是前面介绍的朴素极限概念的最自然的（ 事实上，这是唯一可能的）扩展！ 我们会建立这个事实，继而考虑其他平坦性的性质; 不错的技术讨论见Eisenbud [1995]; Matsumura [1986]; Hartshorne [1977]. \nottran

首先，平坦性在前面已经考虑的例子中表现出了我们希冀的优良性质。

\begin{pro}\label{pro:2.29}
	令$B=\spec R$是一个非奇异一维仿射概形，$0\in B$是一个闭点以及$B^*=B\setminus \{0\}$. 令$\mathscr{X}\subset \bba_{B}^n$是任意的闭子概形，以及投影$\pi:\mathscr{X}\to B$. 下面的条件是等价的：
	\begin{compactenum}[\((1)\)]
		\item $\pi$在点$0$处平坦。
		\item 纤维$X_0=\pi^{-1}(0)$是纤维族$X_b=\pi^{-1}(b)$在$b\to 0$时的极限。
		\item $X$没有支集是$X_0$的不可约组分或者嵌入组分。
	\end{compactenum}
\end{pro}

\begin{proof}
我们从(2)和(3)的等价开始，令$\mathscr{X}^*=\pi^{-1}(B^*)\subset \mathscr{X}$. 因为$\mathscr{X}\subset \bba_B^n$是闭的，它包含$\mathscr{X}^*$的闭包，于是纤维$X_0=\pi^{-1}(0)$包含纤维$X_b=\pi^{-1}(b)$当$b\to 0$时的极限，因此，$X_0=\lim_{b\to 0} X_b$等价于$\mathscr{X}=\overline{\mathscr{X}^*}$. 反过来，$X_0$真包含$X_b$的极限当且仅当$\overline{\mathscr{X}^*} \subsetneqq \mathscr{X}$，即，作为闭子概形的并，
\[
	\mathscr{X}=\overline{\mathscr{X}^*}\cup X_0
\]
是不平凡的。于是(2)和(3)等价。

为了看到(1)与(3)的等价，观察到$\oo_{\mathscr{X},x}$作为$\oo_{B,0}$\hyp 模对每一个$x\in X_0$是平坦的，当且仅当$\oo_{\mathscr{X}}(\mathscr{X})$作为$R$\hyp 模是自由的（见Bourbaki [1972, \uppercase\expandafter{\romannumeral1}.2.4, Porposition 3.\expandafter{\romannumeral2}]；这点不难从这里的环$R$都是主理想整环得到，见Matsumura [1986, Theorem 7.6以及在第50页的逆命题]或者Eisenbud [1995, Corollary 6.3]）。
\end{proof}

这个平坦性的解释有多一般呢？首先，平坦性条件在态射$\pi:\mathscr{X}\to B$的定义域\nottran 中是局部性的，所以$\mathscr{X}$和$B$是仿射概形的假设实际上并不失一般性。此外，如果还假设$\mathscr{X}$在$B$上是\textit{有限型}的，这是另一个温和的有限性条件，它将在第\ref{s:3.1.1}节描述，我们还可以进一步将问题约化到$\mathscr{X}$是$\bba_B^n$的一个闭子概形，而$\pi$是投射$\bba_B^n\to B$在$\mathscr{X}$上的限制。所有这些都是次要的假设，在应用到上面的结果中最紧要的限制是我们取$B$是一维非奇异的。然而，我们可以通过以下的引理来扩大这一范围，它刻画了有限型平坦族在约态基上的表现。

\begin{lem}\label{lem:2.30}
	令$K$是一个域，$B$是一个约态$K$\hyp 概形，$b\in B$是一个闭点，而$\mathscr{X}\subset \bba_{B}^n$是一个闭子概形。 $\mathscr{X}$在点$b$处平坦当且仅当，对每一个非奇异一维$K$\hyp 概形$B'$，每一个闭点$0\in B'$以及任意将$0$变成$b$的态射$\varphi:B'\to B$，纤维$X_b$是纤维$X_{\varphi(b')}$在$b'$趋向于$0$时候的极限，即，对任意将$0$变成$b$的态射$\varphi:B'\to B$，拉回族
	\[
	\mathscr{X}'=\mathscr{X}\times_B B'\subset \bba_{B'}^n\to B'
	\]
	在点$0$处平坦。
\end{lem}

\begin{proof}
因为$X_{\varphi(b')}=X'_{b'}$，Proposition \ref{pro:2.29}断言了极限条件$X_b=\lim_{b'\to 0}X_{\varphi(b')}$与$\mathscr{X}'$在$B'$上的平坦性条件是等价的。这就说明了一个方向是清楚的：一般地，如果$\mathscr{X}\to B$是平坦的，而$B'\to B$是任意的态射，纤维积$\mathscr{X}\times_B B'\to B'$是平坦的，见Matsumura [1986, Chapter 2, Section 3]. 另一个方向困难很多，见Raynaud \& Gruson [1971, Cor. 4.2.10].
\end{proof}

当Lemma \thethm 的条件满足时，我们将称纤维$X_b$是$\mathscr{X}$在$B$上邻近纤维的\textit{平坦极限}。

一句警告：尽管对一维的$B$以及非奇异点$0\in B$，对$B^*=B\setminus \{0\}$上的给定族$\mathscr{X}\subset \bba_{B^*}^n$存在唯一的平坦极限，\textit{然而双参数族可能根本没有任何平坦极限。}比如考虑前面讨论过的$\bba_K^2$中度为$2$的子概形族。我们这里取基$B=\spec K[s,t]=\bba_{K}^2$，其中原点是我们取顶的点$0\in B$. 对$(s,t)\neq (0,0)\in B$，我们令$X_{s,t}\subset K[x,y]=\bba_K^2$是包含点$(x,y)$和$(x-s,y-t)\in \bba_K^2$的并的子概形。由
\[
	\mathscr{X}^*=V\bigl(x(x-s),x(y-t),y(x-s),y(y-t)\bigr)\subset \bba_{B^*}^2
\]
定义的这些子概形构成了$B^*=B\setminus \{0\}$上的一个族$\mathscr{X}^*$. 但是我们已经看到，概形族$X_{s,t}$在$(s,t)$沿着不同类型的直线趋向于原点时候将得到不同的双重点：它们的支集都是原点，但有着不同的切线。$\bba_B^2$中的$\mathscr{X}$的闭包$\mathscr{X}=\overline{\mathscr{X}^*}\subset \bba_B^2$在点$0\in B$的纤维$X_0$于是必须包含这些双重点的并，即，他必须包含“丰满点\footnote{译者注：原文是`fat point'.}”$V(x^2,xy,y^2)\subset \bba_K^2$. 于是，闭包必须是子概形
\[
	\mathscr{X}=V\bigl(x(x-s),x(y-t),y(x-s),y(y-t)\bigr)\subset \bba_{B}^2,
\]
它在原点的纤维就是$V(x^2,xy,y^2)$. 特别地，我们看到，$\mathbb{A}_B^2$ \textit{中}，\textit{没有将} $\mathscr{X}^*$ {\large\it 作为开子概形的闭子概形能在点} $0\in B$ \textit{处平坦}。

这里的态射$\mathscr{X}\to B$与Exercise \ref{exe:1.43}(b)中的态射$X\to Y$是相同的。

\begin{exe}
考虑圆锥曲线$B=V(su-t^2)\subset K[s,t,u]=\bba_K^3$. 令$0=(s,t,u)\in B$是原点，$B^*=B\setminus {0}$. 置$\mathscr{X}=\spec K[x,y]=\bba_K^2$，$\varphi:\mathscr{X}\to B$是对偶于环的含入同态
\[
	\varphi^{\#}:K[s,t,u]/(su-t^2)\to K[x,y]
\]
的映射，其中环同态$\varphi^{\#}$将$s$映到$x^2$、$t$映到$xy$和$u$映到$y^2$. （等价地，$B$就是$\mathscr{X}=\bba_K^2$在$(x,y)\mapsto (-x,-y)$下的商，而$\varphi$就是商映射。）令$\mathscr{X}^*$是原像$\varphi^{-1}(B^*)\subset \mathscr{X}$. 证明$\mathscr{X}\to B$在$0$处不平坦。
\end{exe}

事实上，族$\mathscr{X}^*\to B^*$\textit{没有}平坦极限，因为没有概形$\mathscr{Y}$以及满射$\nu:\mathscr{Y}\to B$使得作为$B^*$\hyp 概形，$\nu^{-1}(B^*)\cong \mathscr{X}^*$. 但这也不是真的病态，在第\ref{s:4.3.2}节中，我们将看到没有平坦极限的族会自然地出现。

至少当$B$是一个域上的约态概形，而$X$在$B$上是有限型的时候，Propostion \ref{pro:2.29}以及Lemma \ref{lem:2.30}一起给出了态射$\varphi:\mathscr{X}\to B$的平坦性的几何解释。它们说明了，如果$\varphi$在点$p$是平坦的，则在任意$p\in\mathscr{X}$的邻域到仿射空间$\mathbb{A}_B^n$的嵌入下，点$0=\varphi(p)\in B$处的纤维$X_0=\varphi^{-1}(0)$是纤维$X_b$在$b\in B$沿着某个单参族趋向于$0$时的极限（的一个开集）。一般来说，平坦性的定义的奇妙之处在于，它将这个基本概念以非常自然的方式扩展到任意态射！因此，尤其当基空间$B$是一个非约态概形的时候，这是非常值得注意的（和实用的）。比如，如果$B=\spec K[\epsilon]/(\epsilon^2)$，讨论“$\mathscr{X}\to B$在附近点处的纤维”是没有意义的，$B$只有一个点。尽管如此，我们将在第\ref{chap:6}章中明确地看到，谈论由$B$参数化的“连续变化”概形族$\mathscr{X}\to B$\textit{是}有意义的; 平坦性确切地捕捉了这个属性。（即使，基底$B$有一个一维Zariski切空间，就像例子$B=\spec K[\epsilon]/(\epsilon^2)$中那样，我们不能使用判别法，因为没有$\mathscr{X}$的任意组分（无论是不可约的或是嵌入的）的支集是约态点$B_{\text{red}}$的原像：比如，对偶于环同态$\epsilon\mapsto x$的态射$\spec K[x,y]/(x^2,xy,y^2)\to \spec K[\epsilon]/(\epsilon^2)$不是平坦的。）

一般地，如果$B=\spec R$是局部Artin环$R$的谱，$R$的极大理想是$\mm$，$0=V(\mm)=B_{\text{red}}\subset B$是$B$的唯一一点，则平坦概形$\varphi:\mathscr{X}\to B$被称为纤维$X_0=\varphi^{-1}(0)$的一个“无穷小形变”。这样的东西在曲面上的曲线理论的代数化中发挥了巨大的作用，比如见Mumford [1966]以及他在Section \uppercase\expandafter{\romannumeral6}.2.3.中的讨论。

作为这节的结束，我们提出（但不证明）两个关于平坦性的事实，这两点都将再一次说明，平坦性确实是一个概形族$\mathscr{X}\to B$“连续变化”的正确准则。第一个是我们一开始提到过的：我们希望超曲面族平坦。具体地说就是，如果
\[
	f(\text{$x_1$, $\dots$, $x_n$})=\sum a_I x^I
\]
是一个$n$变量的多项式，而系数$a_I$是概形$B$上的正则函数，于是对应的子概形$V(f)\in \mathbb{A}_B^n$至少应该在系数的公共零点集$V(\{a_I\})\subset B$外平坦。事实上，不止如此，同样的命题对完全交（complete intersection）$\mathscr{X}=V(f_1$, $\dots$, $f_c)\subset \bba_B^n$也成立。陈述如下：

\begin{pro}
	令$R$是一个局部环，$\mm$是它的极大理想，$B=\spec R$，$0=[\mm]\in B$是$B$中的唯一闭点以及$\kappa=\kappa(0)=R/\mm$是剩余类域。令$f_1$, $\dots$, $f_n\in R[x_1$, $\dots$, $x_n]$是$R$系数多项式，以及
	\[
	\mathscr{X}=V(\text{$f_1$, $\dots$, $f_n$})\subset \spec R[\text{$x_1$, $\dots$, $x_n$}]=\bba_{B}^n.
	\]
	如果$X_0=\pi^{-1}(0)$是投射$\pi:\mathscr{X}\to B$在点$0$处的纤维，它的在$\mathbb{A}_{\kappa}^n$中的余维数是$c$，则$\mathscr{X}\to B$是平坦的。
\end{pro}

更一般地，我们有下面的平坦性判别法，它在实际中非常管用。

\begin{exe}
\begin{compactenum}[(a)]
\item 证明，在环$R=K[t]_{(t)}$上的模$M$是平坦的，当且仅当$t$在$M$上不是零因子，即，当且仅当$M$是无挠的。

\item 令$A=R[x_1$, $\dots$, $x_n]$是环$R=K[t]_{(t)}$上的多项式，再令$M$是一个具有自由表示
\[
	F_1\xrightarrow{\varphi}F_0\to M\to 0
\]
的$A$\hyp 模。考虑在商模$\bar{A}:=A/tA$上的模$\bar{M}:= M/M_t$，以及令
\[
	\bar{F}_1\xrightarrow{\bar{\varphi}}\bar{F}_0\to \bar{M}\to 0
\]
是对应的表示。证明$M$在$R$上是平坦的，当且仅当，每一个$\bar{M}$在$\bar{A}$上的二阶合冲\footnote{译者注：这个译名选自康明昌先生的《近世代数》一书，不知是否有更早的翻译。关于syzygz可见\href{https://en.wikipedia.org/wiki/Hilbert\%27s_syzygy_theorem\#Sygyzies_.28relations.29}{Hilbert's syzygz theorem}， 简单来说，就是关系（relation/the first syzygz）生成的模。}（the second syzygz）能被提升为$A$上的二阶合冲，使得$\bar{\varphi}$的核中每一个元素来自于$\varphi$的核中。（对任意的局部基环$R$，极大理想是$\mm$，若$M$是$A$上的有限生成模，则类似的命题也是正确的。这是“平坦性的局部判别法”的一种形式，比如可见Eisenbud [1995, Section 6.4]或者Matsumura[1986, p. 174]。）
\end{compactenum}
\end{exe}

其次，平坦性是一个好概念还因为Grothendieck证明的\textit{一般平坦性定理}（{\it generic flatness theorem}）（比如可见Eisenbud [1995, Section 14.2].）定理说明了，对任意在约态基上合理的概形族$X\to B$，存在一个$B$的稠密开集$U$使得限制族$\pi^{-1}U\to U$是平坦的（这里“合理”的族包含了诸如任意给定仿射/射影概形的子概形族）。在某种意义上，这证明了我们选择的平坦性是拓扑中丛的类似物：观察到如果$f:M\to N$是一个紧$C^\infty$流形之间的可微映射，于是存在一个$N$上的稠密的开集族使得对开集族中的元素$U$，将$f$限制到$f^{-1}(U)$上就得到了一个纤维丛。无论如何，一般平坦性定理保证了平坦族在代数几何中是普遍存在的。

这就结束我们关于平坦性的第一次讨论。在第\ref{chap:4}章讨论射影概形族的时候，我们将会看到平坦性的其他几何解释。

\subsection{多重直线}

现在考虑一个非约态仿射概形$X$，它没有嵌入组分且支集是一条直线。我们将假设这条直线的重数（准素分解意义上）是$2$. 下面我们分析各种可能性。

很容易写出第一个例子：概形
\[
	X=\spec K[x,y]/(y^2)\subset \bba_K^2
\]
显然有所有想要的性质。很清楚，在$\bba_K^2$中此外再无支集是直线$y=0$的例子，不过我们能在$\bba_K^3$中构造不少。我们需要的这类子概形$X$，将交于$\bba_{K}^3$中的一个一般平面，它将穿过包含于该平面上的双重点中的一个约态直线上的点。\nottran 已经知道，任意的双重点都可以想成一个点加上一个该点处的切矢量。这就建议我们，可以通过在直线的每一点处给定一个法方向得到$X$. 比如，取$L:=X_{\text{red}}$为直线$x=y=0$，坐标为$z$，选一对没有公共零点的$z$的多项式$p$和$q$，在每一点$(0,0,z_0)\in L$取法方向为法平面$z=z_0$中斜率$p(z_0)/q(z_0)$为的那个方向。很容易看到，所有在给定方向上的双重点的$z$的并将被包含于由
\[
	I_{p,q}=(x^2,xy,y^2,p(z)x-q(z)y)
\]
以及
\[
	X_{p,q}=\spec K[x,y,z]/I_{p,q}
\]
定义的概形$X_{p,q}$中。其中，最简单的非平面例子是，选择法方向绕$L$转一圈，比如，由理想
\[
	I_\Gamma=(x^2,xy,y^2,zy-x)
\]
给出的概形。

\begin{center}\includegraphics[scale=\scale,bb=0 0 684 279]{\PICDIR/14.png}\end{center}

\begin{exe}
如果$p$, $q$是互素的多项式，于是环
\[
	K[x,y,z]/I_{p,q}
\]
中的理想
\[
	(x,y)/I_{p,q}
\]
是秩为$1$的无挠$K[z]$\hyp 模，于是$X_{p,q}$是准素的，$(X_{p,q})_{\text{red}}$是直线$\spec K[x,y,z]/(x,y)$，以及$X_{p,q}$的重数为$2$.
\end{exe}

尽管第一眼看上去，这些例子有不少有趣的不变量，特别地，它们应该是可区分的，但事实并非如此：我们能通过$\bba_{K}^3$的自同构给出任意一个概形$X_{p,q}$到平面双重直线$\spec K[y,z]/(y^2)$的同构，将其“解耦”。为了证明这点，注意到，因为$p$和$q$没有共同零点，所以存在多项式$a$, $b\in K[z]$使得$1=aq+bp$，矩阵
\[
	\begin{pmatrix}
	a&b\\
	p&-q
	\end{pmatrix}
\]
的行列式可逆，所以由
\[
	(x,y,z)\mapsto (x',y',z),\quad \text{其中$x':=p(z)x-q(z)y$, $y':=a(z)x+b(z)y$}
\]
给出的映射$\bba_K^3\to \bba_K^3$是可逆的。同样因为上面的矩阵是可逆的，我们有
\[
	(x,y)=(x',y')\quad\text{和}\quad (x^2,xy,y^2)=({x'}^2,x'y',{y'}^2)
\]
于是$X_{p,q}$的理想是$(x,x^2,xy,y^2)=(x,y^2)$,正如所需。

更一般地，在下题意义上，可以证明精确到同构只存在一条仿射双重直线。

\begin{exe}
	证明，如果$A$一个Noether $K$\hyp 代数，使得$X=\spec A$没有嵌入组分，重数为$2$，以及满足$X_{\text{red}}\cong \bba_K^1$,于是$X$同构于$\spec K[x,y]/(y^2)$.
\end{exe}

我们将在下一章看到，射影空间中的情况与此不同：那里有许多不同构的射影双重直线。